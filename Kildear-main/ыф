> database
static
>uploads
Js profile.js
document.addEventListener('DOMContentLoaded', function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const editProfileForm = document.getElementById('edit-profile-form');
    const changePasswordForm = document.getElementById('change-password-form');
    const changeUsernameForm = document.getElementById('change-username-form');
    const deleteAccountBtn = document.getElementById('delete-account');
    const changeAvatarBtn = document.getElementById('change-avatar');
    const removeAvatarBtn = document.getElementById('remove-avatar');
    const avatarInput = document.getElementById('avatar-input');
    const avatarPreview = document.getElementById('avatar-preview');
    const themeOptions = document.querySelectorAll('.theme-option');

    let currentAvatarData = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º
    themeOptions.forEach(option => {
        option.addEventListener('click', () => {
            themeOptions.forEach(opt => opt.classList.remove('active'));
            option.classList.add('active');
            const theme = option.dataset.theme;
            applyTheme(theme);
            localStorage.setItem('theme', theme);
        });
    });

    // –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
    changeAvatarBtn.addEventListener('click', () => {
        avatarInput.click();
    });

    avatarInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
            return;
        }

        if (file.size > 5 * 1024 * 1024) { // 5MB
            showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ (–º–∞–∫—Å–∏–º—É–º 5MB)', 'error');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            currentAvatarData = e.target.result;
            avatarPreview.innerHTML = `<img src="${currentAvatarData}" alt="–ê–≤–∞—Ç–∞—Ä">`;
        };
        reader.onerror = function() {
            showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
        };
        reader.readAsDataURL(file);
    });

    // –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏
    removeAvatarBtn.addEventListener('click', () => {
        currentAvatarData = null;
        const placeholder = avatarPreview.querySelector('.avatar-placeholder');
        if (!placeholder) {
            const userInitial = document.querySelector('.user-info h2').textContent[0];
            avatarPreview.innerHTML = `<div class="avatar-placeholder" style="background: var(--primary-color);">${userInitial}</div>`;
        }
    });

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    editProfileForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const name = document.getElementById('edit-name').value.trim();
        const description = document.getElementById('edit-description').value.trim();
        const activeTheme = document.querySelector('.theme-option.active').dataset.theme;

        if (!name) {
            showNotification('–ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º', 'error');
            return;
        }

        const data = {
            name: name,
            description: description,
            theme: activeTheme
        };

        if (currentAvatarData) {
            data.avatar = currentAvatarData;
        }

        const submitBtn = editProfileForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
        submitBtn.disabled = true;

        fetch('/api/profile/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(result => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

            if (result.success) {
                showNotification('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
                document.querySelector('.user-info h2').textContent = name;
                if (description) {
                    document.querySelector('.description').textContent = description;
                }
                currentAvatarData = null;
            } else {
                showNotification(result.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
        });
    });

    // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
    changePasswordForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const currentPassword = document.getElementById('current-password').value;
        const newPassword = document.getElementById('new-password').value;
        const confirmPassword = document.getElementById('confirm-new-password').value;

        if (!currentPassword || !newPassword || !confirmPassword) {
            showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
            return;
        }

        if (newPassword.length < 6) {
            showNotification('–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
            return;
        }

        if (newPassword !== confirmPassword) {
            showNotification('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
            return;
        }

        const submitBtn = changePasswordForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è...';
        submitBtn.disabled = true;

        fetch('/api/profile/change_password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                current_password: currentPassword,
                new_password: newPassword,
                confirm_password: confirmPassword
            })
        })
        .then(response => response.json())
        .then(result => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

            if (result.success) {
                showNotification('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                changePasswordForm.reset();
            } else {
                showNotification(result.message || '–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
        });
    });

    // –°–º–µ–Ω–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞
    changeUsernameForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const newUsername = document.getElementById('new-username').value.trim().toLowerCase();
        const password = document.getElementById('password-for-username').value;

        if (!newUsername || !password) {
            showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
            return;
        }

        if (newUsername.length < 3) {
            showNotification('–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
            return;
        }

        if (newUsername === document.querySelector('.username').textContent.substring(1)) {
            showNotification('–≠—Ç–æ –≤–∞—à —Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä–Ω–µ–π–º', 'info');
            return;
        }

        const submitBtn = changeUsernameForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–º–µ–Ω–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞...';
        submitBtn.disabled = true;

        fetch('/api/profile/change_username', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                new_username: newUsername,
                password: password
            })
        })
        .then(response => response.json())
        .then(result => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

            if (result.success) {
                showNotification('–Æ–∑–µ—Ä–Ω–µ–π–º —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                document.querySelector('.username').textContent = '@' + newUsername;
                document.getElementById('new-username').value = newUsername;
                changeUsernameForm.reset();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                showNotification(result.message || '–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã —é–∑–µ—Ä–Ω–µ–π–º–∞', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
        });
    });

    // –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
    deleteAccountBtn.addEventListener('click', () => {
        if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–ª–Ω–æ–º—É —É–¥–∞–ª–µ–Ω–∏—é –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.')) {
                showNotification('–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
                // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
            }
        }
    });

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.remove('light-theme');
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
            document.body.classList.add('light-theme');
        }
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;

        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-circle';

        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    console.log('–ü—Ä–æ—Ñ–∏–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
});

JS script.js

document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const socket = io();
    const currentUser = document.getElementById('current-user').value;
    const currentUserName = document.getElementById('current-user-name').value;
    const currentUserColor = document.getElementById('current-user-color').value;
    const isAdmin = document.getElementById('is-admin') ? document.getElementById('is-admin').value === 'true' : false;

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    let currentRecipient = null;
    let currentRecipientName = '';
    let currentRecipientColor = '';
    let typingTimeout = null;
    let currentAttachment = null;
    let allMessages = [];

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
    let activeCall = null;
    let peerConnection = null;
    let localStream = null;
    let remoteStream = null;
    let callTimer = null;
    let callStartTime = null;
    let isMuted = false;
    let isVideoMuted = false;

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const messagesContainer = document.getElementById('messages-container');
    const messageInput = document.getElementById('message-input');
    const typingIndicator = document.getElementById('typing-indicator');
    const typingText = document.getElementById('typing-text');
    const messageInputContainer = document.getElementById('message-input-container');
    const chatHeader = document.getElementById('chat-header');
    const onlineCount = document.getElementById('online-count');
    const contactsList = document.getElementById('contacts-list');
    const emptyContacts = document.getElementById('empty-contacts');
    const sendMessageBtn = document.getElementById('send-message-btn');

    // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
    const attachPhotoBtn = document.getElementById('attach-photo');
    const attachVideoBtn = document.getElementById('attach-video');
    const photoInput = document.getElementById('photo-input');
    const videoInput = document.getElementById('video-input');
    const attachmentPreview = document.getElementById('attachment-preview');
    const previewImage = document.getElementById('preview-image');
    const previewVideo = document.getElementById('preview-video');
    const previewInfo = document.getElementById('preview-info');
    const removeAttachmentBtn = document.getElementById('remove-attachment');

    // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
    const callModal = document.getElementById('call-modal');
    const callTitle = document.getElementById('call-title');
    const callTimerElement = document.getElementById('call-timer');
    const callStatus = document.getElementById('call-status');
    const callWith = document.getElementById('call-with');
    const acceptCallBtn = document.getElementById('accept-call-btn');
    const rejectCallBtn = document.getElementById('reject-call-btn');
    const endCallBtn = document.getElementById('end-call-btn');
    const muteAudioBtn = document.getElementById('mute-audio-btn');
    const muteVideoBtn = document.getElementById('mute-video-btn');
    const localVideo = document.getElementById('local-video');
    const remoteVideo = document.getElementById('remote-video');

    // ============ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ============

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket
    function initWebSocket() {
        socket.on('connect', () => {
            console.log('‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É');
            showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É', 'success');
            loadContacts();

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Ç
            restoreLastChat();
        });

        socket.on('disconnect', () => {
            console.log('‚úó –û—Ç–∫–ª—é—á–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            showNotification('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
        });

        socket.on('connect_error', (error) => {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
        });

        socket.on('user_status', handleUserStatus);
        socket.on('new_message', handleNewMessage);
        socket.on('message_sent', handleMessageSent);
        socket.on('user_typing', handleUserTyping);
        socket.on('message_edited', handleMessageEdited);
        socket.on('message_deleted', handleMessageDeleted);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
        socket.on('incoming_call', handleIncomingCall);
        socket.on('call_accepted', handleCallAccepted);
        socket.on('call_rejected', handleCallRejected);
        socket.on('call_ended', handleCallEnded);
        socket.on('call_timeout', handleCallTimeout);
        socket.on('call_error', handleCallError);
        socket.on('webrtc_signal', handleWebRTCSignal);
        socket.on('call_ice_candidate', handleCallIceCandidate);
    }

    // ============ –ü–û–ò–°–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ============
    function initSearch() {
        if (!searchInput) return;

        searchInput.addEventListener('input', debounce(function(e) {
            const query = e.target.value.trim();
            if (query.length < 1) {
                searchResults.style.display = 'none';
                return;
            }
            searchUsers(query);
        }, 300));

        document.addEventListener('click', function(e) {
            if (searchResults && !searchResults.contains(e.target) && e.target !== searchInput) {
                searchResults.style.display = 'none';
            }
        });
    }

    function searchUsers(query) {
        fetch(`/search_users?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(users => displaySearchResults(users))
            .catch(error => console.error('Search error:', error));
    }

    function displaySearchResults(users) {
        if (!searchResults) return;

        if (!users || users.length === 0) {
            searchResults.innerHTML = '<div class="no-results">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            searchResults.style.display = 'block';
            return;
        }

        searchResults.innerHTML = '';
        users.forEach(user => {
            const userElement = document.createElement('div');
            userElement.className = 'contact-item search-result';
            userElement.innerHTML = `
                <div class="contact-avatar" style="background: ${user.avatar_color || '#4ECDC4'}">
                    ${user.avatar ? `<img src="${user.avatar}" alt="${user.name}">` : user.name[0].toUpperCase()}
                    <span class="status-indicator ${user.is_online ? 'online' : ''}"></span>
                </div>
                <div class="contact-info">
                    <div class="contact-name-row">
                        <h4>${escapeHtml(user.name)}</h4>
                        <span class="user-status-badge ${user.is_online ? 'online' : 'offline'}">
                            ${user.is_online ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω'}
                        </span>
                    </div>
                    <p class="contact-preview">
                        @${escapeHtml(user.username)}
                    </p>
                </div>
            `;

            userElement.addEventListener('click', () => {
                openChat(user.username, user.name, user.avatar_color || '#4ECDC4');
                searchInput.value = '';
                searchResults.style.display = 'none';
            });

            searchResults.appendChild(userElement);
        });

        searchResults.style.display = 'block';
    }

    // ============ –ó–ê–ì–†–£–ó–ö–ê –ö–û–ù–¢–ê–ö–¢–û–í ============
    function loadContacts() {
        fetch('/api/get_chats')
            .then(response => response.json())
            .then(chats => displayContacts(chats))
            .catch(error => console.error('Error loading contacts:', error));
    }

    function displayContacts(chats) {
        if (!contactsList || !emptyContacts) return;

        if (!chats || chats.length === 0) {
            emptyContacts.style.display = 'block';
            contactsList.innerHTML = '';
            return;
        }

        emptyContacts.style.display = 'none';
        contactsList.innerHTML = '';

        chats.forEach(chat => {
            const contactElement = createContactElement(chat);
            contactsList.appendChild(contactElement);
        });

        updateOnlineCount();
    }

    function createContactElement(chat) {
        const contactItem = document.createElement('div');
        contactItem.className = 'contact-item';
        contactItem.dataset.username = chat.username;
        contactItem.dataset.color = chat.avatar_color || '#4ECDC4';

        let lastMessage = '';
        if (chat.last_message) {
            if (chat.last_message.type === 'image') {
                lastMessage = 'üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
            } else if (chat.last_message.type === 'video') {
                lastMessage = 'üé¨ –í–∏–¥–µ–æ';
            } else if (chat.last_message.type === 'sticker') {
                lastMessage = 'üòä –°—Ç–∏–∫–µ—Ä';
            } else {
                lastMessage = chat.last_message.message || '';
            }
        }

        const time = chat.last_message ? formatTime(chat.last_message.timestamp) : '';

        contactItem.innerHTML = `
            <div class="contact-avatar" style="background: ${chat.avatar_color || '#4ECDC4'}">
                ${chat.avatar ? `<img src="${chat.avatar}" alt="${chat.name}">` : chat.name[0].toUpperCase()}
                <span class="status-indicator ${chat.is_online ? 'online' : ''}" id="status-${chat.username}"></span>
            </div>
            <div class="contact-info">
                <div class="contact-name-row">
                    <h4>${escapeHtml(chat.name)}</h4>
                    <span class="message-time">${time}</span>
                </div>
                <p class="contact-preview">
                    ${escapeHtml(lastMessage.substring(0, 30))}${lastMessage.length > 30 ? '...' : ''}
                </p>
            </div>
        `;

        contactItem.addEventListener('click', () => {
            openChat(chat.username, chat.name, chat.avatar_color || '#4ECDC4');
        });

        return contactItem;
    }

    // ============ –û–¢–ö–†–´–¢–ò–ï –ò –°–û–•–†–ê–ù–ï–ù–ò–ï –ß–ê–¢–ê ============
    function openChat(username, name, color) {
        if (currentRecipient === username) return;

        currentRecipient = username;
        currentRecipientName = name;
        currentRecipientColor = color;

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —á–∞—Ç
        saveCurrentChat(username);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateChatHeader();

        if (messageInputContainer) {
            messageInputContainer.style.display = 'flex';
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
        loadMessages();

        // –ü–æ–º–µ—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
        updateActiveContact();

        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        setTimeout(() => {
            if (messageInput) messageInput.focus();
        }, 100);
    }

    function saveCurrentChat(username) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        localStorage.setItem('lastChat', JSON.stringify({
            username: username,
            name: currentRecipientName,
            color: currentRecipientColor,
            timestamp: Date.now()
        }));

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
        fetch('/api/save_current_chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ chat_with: username })
        }).catch(error => console.error('Error saving chat:', error));
    }

    function restoreLastChat() {
        const lastChat = localStorage.getItem('lastChat');
        if (lastChat) {
            try {
                const chatData = JSON.parse(lastChat);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç –¥–∞–Ω–Ω—ã—Ö (–Ω–µ —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)
                const chatAge = Date.now() - (chatData.timestamp || 0);
                if (chatAge > 24 * 60 * 60 * 1000) {
                    localStorage.removeItem('lastChat');
                    return;
                }

                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç
                if (chatData.username) {
                    fetch(`/api/user/${chatData.username}`)
                        .then(response => response.json())
                        .then(user => {
                            if (!user.error) {
                                setTimeout(() => {
                                    openChat(user.username, user.name, user.avatar_color);
                                }, 300);
                            }
                        })
                        .catch(() => {
                            localStorage.removeItem('lastChat');
                        });
                }
            } catch (e) {
                localStorage.removeItem('lastChat');
            }
        }
    }

    // ============ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê –ß–ê–¢–ê ============
    function updateChatHeader() {
        if (!chatHeader) return;

        chatHeader.innerHTML = `
            <div class="user-profile">
                <div class="user-avatar" style="background: ${currentRecipientColor}" id="chat-user-avatar">
                    ${currentRecipientName[0].toUpperCase()}
                    <span class="status-indicator" id="header-status-${currentRecipient}"></span>
                </div>
                <div class="user-info">
                    <h3 id="chat-user-name">${escapeHtml(currentRecipientName)}</h3>
                    <p class="user-status" id="header-status-text-${currentRecipient}">
                        <i class="fas fa-circle"></i> –ø—Ä–æ–≤–µ—Ä–∫–∞...
                    </p>
                </div>
            </div>
            <div class="chat-actions">
                <button class="btn-icon" id="voice-call-btn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="btn-icon" id="video-call-btn" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-video"></i>
                </button>
                <button class="btn-icon" id="block-user-btn" title="–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å">
                    <i class="fas fa-ban"></i>
                </button>
                <button class="btn-icon" id="view-profile-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        `;

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
        setTimeout(() => {
            const voiceCallBtn = document.getElementById('voice-call-btn');
            const videoCallBtn = document.getElementById('video-call-btn');
            const blockBtn = document.getElementById('block-user-btn');
            const viewProfileBtn = document.getElementById('view-profile-btn');

            if (voiceCallBtn) {
                voiceCallBtn.addEventListener('click', () => startCall('audio'));
            }
            if (videoCallBtn) {
                videoCallBtn.addEventListener('click', () => startCall('video'));
            }
            if (blockBtn) {
                blockBtn.addEventListener('click', toggleBlockUser);
            }
            if (viewProfileBtn) {
                viewProfileBtn.addEventListener('click', () => {
                    window.open(`/profile/${currentRecipient}`, '_blank');
                });
            }
        }, 100);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
        checkOnlineStatus(currentRecipient);
    }

    function updateActiveContact() {
        document.querySelectorAll('.contact-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.username === currentRecipient) {
                item.classList.add('active');
            }
        });
    }

    // ============ –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ============
    function initMessageForm() {
        if (!messageInput || !sendMessageBtn) return;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        sendMessageBtn.addEventListener('click', sendMessage);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—á–∞—Ç–∞–Ω–∏—è
        messageInput.addEventListener('input', () => {
            if (!currentRecipient) return;

            socket.emit('typing', {
                recipient: currentRecipient,
                is_typing: true
            });

            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                socket.emit('typing', {
                    recipient: currentRecipient,
                    is_typing: false
                });
            }, 1000);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–ª–æ–∂–µ–Ω–∏–π
        initAttachments();
    }

    function sendMessage() {
        const messageText = messageInput ? messageInput.value.trim() : '';

        if ((!messageText && !currentAttachment) || !currentRecipient) {
            showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª', 'info');
            return;
        }

        if (!socket.connected) {
            showNotification('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            return;
        }

        let messageData = {
            recipient: currentRecipient,
            message: messageText || '',
            type: 'text'
        };

        // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ
        if (currentAttachment) {
            messageData.type = currentAttachment.type;
            messageData.file_name = currentAttachment.file.name;
            messageData.file_size = currentAttachment.file.size;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result;
                if (base64Data.length > 50 * 1024 * 1024) {
                    showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 15MB)', 'error');
                    removeAttachment();
                    return;
                }

                messageData.file_data = base64Data;
                sendMessageToServer(messageData);
            };

            reader.onerror = function() {
                showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                removeAttachment();
            };

            try {
                reader.readAsDataURL(currentAttachment.file);
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞', 'error');
                removeAttachment();
            }
        } else {
            sendMessageToServer(messageData);
        }

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å "–ø–µ—á–∞—Ç–∞–µ—Ç"
        clearTimeout(typingTimeout);
        socket.emit('typing', {
            recipient: currentRecipient,
            is_typing: false
        });
    }

    function sendMessageToServer(messageData) {
        const originalIcon = sendMessageBtn.innerHTML;
        sendMessageBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        sendMessageBtn.disabled = true;

        socket.emit('send_message', messageData, (response) => {
            sendMessageBtn.innerHTML = originalIcon;
            sendMessageBtn.disabled = false;

            if (response && response.error) {
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + response.error, 'error');
            } else {
                if (messageInput) messageInput.value = '';
                removeAttachment();
                loadContacts();
            }
        });
    }

    // ============ –í–õ–û–ñ–ï–ù–ò–Ø –§–ê–ô–õ–û–í ============
    function initAttachments() {
        if (attachPhotoBtn && photoInput) {
            attachPhotoBtn.addEventListener('click', () => photoInput.click());
            photoInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0], 'image'));
        }

        if (attachVideoBtn && videoInput) {
            attachVideoBtn.addEventListener('click', () => videoInput.click());
            videoInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0], 'video'));
        }

        if (removeAttachmentBtn) {
            removeAttachmentBtn.addEventListener('click', removeAttachment);
        }
    }

    function handleFileSelect(file, type) {
        if (!file) return;

        const maxSize = 15 * 1024 * 1024;
        if (file.size > maxSize) {
            showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 15MB)', 'error');
            return;
        }

        let validTypes = [];
        if (type === 'image') {
            validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/bmp'];
        } else if (type === 'video') {
            validTypes = ['video/mp4', 'video/webm', 'video/ogg', 'video/avi', 'video/mov'];
        }

        if (file.type && !validTypes.includes(file.type)) {
            showNotification(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞`, 'error');
            return;
        }

        currentAttachment = {
            file: file,
            type: type,
            url: URL.createObjectURL(file)
        };

        showAttachmentPreview();
    }

    function showAttachmentPreview() {
        if (!attachmentPreview || !currentAttachment) return;

        attachmentPreview.style.display = 'block';

        if (currentAttachment.type === 'image') {
            if (previewImage) {
                previewImage.style.display = 'block';
                previewImage.innerHTML = `<img src="${currentAttachment.url}" alt="Preview">`;
            }
            if (previewVideo) previewVideo.style.display = 'none';
        } else if (currentAttachment.type === 'video') {
            if (previewImage) previewImage.style.display = 'none';
            if (previewVideo) {
                previewVideo.style.display = 'block';
                previewVideo.innerHTML = `
                    <video controls>
                        <source src="${currentAttachment.url}" type="${currentAttachment.file.type}">
                    </video>
                `;
            }
        }

        if (previewInfo) {
            previewInfo.textContent = `${currentAttachment.type === 'image' ? 'üì∑' : 'üé¨'} ${currentAttachment.file.name} (${formatFileSize(currentAttachment.file.size)})`;
        }
    }

    function removeAttachment() {
        if (currentAttachment) {
            URL.revokeObjectURL(currentAttachment.url);
            currentAttachment = null;
        }
        if (attachmentPreview) {
            attachmentPreview.style.display = 'none';
        }
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
        else return (bytes / 1048576).toFixed(1) + ' MB';
    }

    // ============ –ó–ê–ì–†–£–ó–ö–ê –ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–ô ============
    function loadMessages() {
        if (!currentRecipient) return;

        fetch(`/get_messages/${currentRecipient}`)
            .then(response => response.json())
            .then(messages => {
                allMessages = Array.isArray(messages) ? messages : [];
                displayMessages(allMessages);
            })
            .catch(error => console.error('Error loading messages:', error));
    }

    function displayMessages(messages) {
        if (!messagesContainer) return;

        messagesContainer.innerHTML = '';

        if (!messages || messages.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-chat';
            emptyMessage.innerHTML = `
                <div class="empty-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3>–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</h3>
                <p>–≠—Ç–æ –Ω–∞—á–∞–ª–æ –≤–∞—à–µ–≥–æ —á–∞—Ç–∞ —Å ${currentRecipientName}</p>
            `;
            messagesContainer.appendChild(emptyMessage);
            return;
        }

        messages.forEach(message => {
            addMessageToDOM(message);
        });

        scrollToBottom();
    }

    function addMessageToDOM(message) {
        if (!messagesContainer) return;

        const isOutgoing = message.sender === currentUser;
        const messageElement = document.createElement('div');
        messageElement.className = `message ${isOutgoing ? 'outgoing' : 'incoming'} ${message.deleted ? 'deleted' : ''}`;
        messageElement.dataset.messageId = message.id;

        const time = formatTime(message.timestamp);
        const avatarColor = isOutgoing ? currentUserColor : currentRecipientColor;
        const avatarText = isOutgoing ? currentUserName[0].toUpperCase() : currentRecipientName[0].toUpperCase();

        let messageContent = '';

        if (message.deleted) {
            messageContent = `
                <div class="message-text deleted-text">
                    <i class="fas fa-trash"></i> –°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ${message.deleted_by !== currentUser ? ` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º @${message.deleted_by}` : ''}
                </div>
            `;
        } else if (message.type === 'image') {
            messageContent = `
                <div class="message-media">
                    <img src="/static/uploads/${message.file_path}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" onclick="openMediaViewer('/static/uploads/${message.file_path}', 'image')">
                </div>
                ${message.message ? `<div class="media-caption">${escapeHtml(message.message)}</div>` : ''}
            `;
        } else if (message.type === 'video') {
            messageContent = `
                <div class="message-media">
                    <video controls>
                        <source src="/static/uploads/${message.file_path}" type="video/mp4">
                    </video>
                </div>
                ${message.message ? `<div class="media-caption">${escapeHtml(message.message)}</div>` : ''}
            `;
        } else if (message.type === 'sticker') {
            messageContent = `
                <div class="message-sticker">
                    <div class="sticker-emoji">${escapeHtml(message.message)}</div>
                </div>
            `;
        } else {
            messageContent = `<div class="message-text">${escapeHtml(message.message)}</div>`;
        }

        messageElement.innerHTML = `
            <div class="message-avatar" style="background: ${avatarColor}">
                ${avatarText}
            </div>
            <div class="message-content">
                <div class="message-bubble">
                    ${messageContent}
                    <div class="message-time">${time}</div>
                </div>
            </div>
        `;

        messagesContainer.appendChild(messageElement);
    }

    // ============ WEBSOCKET –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ============
    function handleNewMessage(message) {
        if (!message) return;

        if (message.sender === currentRecipient) {
            addMessageToDOM(message);
            allMessages.push(message);
            scrollToBottom();
            playMessageSound();
            updateLastMessagePreview(message);
        } else {
            showNewMessageNotification(message);
            loadContacts();
        }
    }

    function handleMessageSent(message) {
        if (!message) return;

        if (message.recipient === currentRecipient) {
            addMessageToDOM(message);
            allMessages.push(message);
            scrollToBottom();
            loadContacts();
        }
    }

    function handleMessageEdited(data) {
        if (!data) return;

        const messageElement = document.querySelector(`[data-message-id="${data.message_id}"]`);
        if (messageElement) {
            const messageText = messageElement.querySelector('.message-text');
            if (messageText) {
                messageText.textContent = data.new_text;
            }
        }
    }

    function handleMessageDeleted(data) {
        if (!data) return;

        const messageElement = document.querySelector(`[data-message-id="${data.message_id}"]`);
        if (messageElement) {
            if (data.permanent) {
                messageElement.remove();
            } else {
                messageElement.classList.add('deleted');
                const messageBubble = messageElement.querySelector('.message-bubble');
                if (messageBubble) {
                    messageBubble.innerHTML = `
                        <div class="message-text deleted-text">
                            <i class="fas fa-trash"></i> –°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ${data.deleted_by !== currentUser ? ` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º @${data.deleted_by}` : ''}
                        </div>
                        <div class="message-time">–£–¥–∞–ª–µ–Ω–æ</div>
                    `;
                }
            }
        }
    }

    function handleUserStatus(data) {
        if (!data) return;
        updateOnlineStatus(data.username, data.online);
    }

    function handleUserTyping(data) {
        if (!data || !typingIndicator || !typingText) return;

        if (data.username === currentRecipient && data.is_typing) {
            typingText.textContent = `${currentRecipientName} –ø–µ—á–∞—Ç–∞–µ—Ç...`;
            typingIndicator.style.display = 'flex';
        } else if (data.username === currentRecipient && !data.is_typing) {
            typingIndicator.style.display = 'none';
        }
    }

    // ============ –ó–í–û–ù–ö–ò ============
    function initCallSystem() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∑–≤–æ–Ω–∫–∞
        document.addEventListener('click', function(e) {
            if (e.target.closest('#accept-call-btn')) acceptCall();
            if (e.target.closest('#reject-call-btn')) rejectCall();
            if (e.target.closest('#end-call-btn')) endCall();
            if (e.target.closest('#mute-audio-btn')) toggleMuteAudio();
            if (e.target.closest('#mute-video-btn')) toggleMuteVideo();
        });
    }

    async function startCall(type) {
        if (!currentRecipient) {
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–≤–æ–Ω–∫–∞', 'error');
            return;
        }

        if (activeCall) {
            showNotification('–£–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫', 'error');
            return;
        }

        try {
            const constraints = {
                audio: true,
                video: type === 'video'
            };

            localStream = await navigator.mediaDevices.getUserMedia(constraints);

            const callId = 'call_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

            activeCall = {
                id: callId,
                type: type,
                caller: currentUser,
                callee: currentRecipient,
                status: 'calling',
                direction: 'outgoing'
            };

            showCallInterface('outgoing');

            socket.emit('start_call', {
                to: currentRecipient,
                call_id: callId,
                call_type: type
            });

            // –¢–∞–π–º–∞—É—Ç –∑–≤–æ–Ω–∫–∞
            setTimeout(() => {
                if (activeCall && activeCall.status === 'calling') {
                    endCall();
                    showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç', 'error');
                }
            }, 30000);

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º:', error);
            showNotification('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'error');
            resetCall();
        }
    }

    function handleIncomingCall(data) {
        if (activeCall) {
            socket.emit('reject_call', {
                call_id: data.call_id,
                reason: 'Busy'
            });
            return;
        }

        activeCall = {
            id: data.call_id,
            type: data.type,
            caller: data.caller,
            callee: currentUser,
            status: 'ringing',
            direction: 'incoming'
        };

        showCallInterface('incoming');

        // –ê–≤—Ç–æ–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 45 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (activeCall && activeCall.status === 'ringing') {
                rejectCall();
            }
        }, 45000);
    }

    async function acceptCall() {
        if (!activeCall || activeCall.status !== 'ringing') return;

        try {
            const constraints = {
                audio: true,
                video: activeCall.type === 'video'
            };

            localStream = await navigator.mediaDevices.getUserMedia(constraints);

            activeCall.status = 'active';
            showCallInterface('active');

            socket.emit('accept_call', {
                call_id: activeCall.id
            });

            createPeerConnection();
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });

            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);

            socket.emit('webrtc_signal', {
                to: activeCall.caller,
                call_id: activeCall.id,
                signal: offer
            });

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–≤–æ–Ω–∫–∞:', error);
            endCall();
        }
    }

    function rejectCall() {
        if (!activeCall) return;

        if (activeCall.direction === 'incoming') {
            socket.emit('reject_call', {
                call_id: activeCall.id,
                reason: 'User rejected'
            });
        }

        resetCall();
        showNotification('–ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω', 'info');
    }

    function endCall() {
        if (!activeCall) return;

        const callDuration = callStartTime ? Math.floor((Date.now() - callStartTime) / 1000) : 0;

        socket.emit('end_call', {
            call_id: activeCall.id,
            duration: callDuration
        });

        resetCall();
    }

    function handleCallAccepted(data) {
        if (!activeCall || activeCall.id !== data.call_id) return;

        activeCall.status = 'active';
        showCallInterface('active');

        createPeerConnection();
        localStream.getTracks().forEach(track => {
            peerConnection.addTrack(track, localStream);
        });

        peerConnection.createOffer()
            .then(offer => peerConnection.setLocalDescription(offer))
            .then(() => {
                socket.emit('webrtc_signal', {
                    to: activeCall.callee,
                    call_id: activeCall.id,
                    signal: peerConnection.localDescription
                });
            });
    }

    function handleCallRejected(data) {
        if (!activeCall || activeCall.id !== data.call_id) return;
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–≤–æ–Ω–æ–∫', 'error');
        resetCall();
    }

    function handleCallEnded(data) {
        if (!activeCall || activeCall.id !== data.call_id) return;

        const duration = data.duration || 0;
        const message = duration > 0 ?
            `–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${formatDuration(duration)}` :
            '–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω';

        showNotification(message, 'info');
        resetCall();
    }

    function handleCallTimeout(data) {
        if (!activeCall || activeCall.id !== data.call_id) return;
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª', 'error');
        resetCall();
    }

    function handleCallError(data) {
        showNotification(`–û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞: ${data.message}`, 'error');
        resetCall();
    }

    function handleWebRTCSignal(data) {
        if (!activeCall || activeCall.id !== data.call_id || !peerConnection) return;

        const signal = data.signal;

        if (signal.type === 'offer') {
            peerConnection.setRemoteDescription(new RTCSessionDescription(signal))
                .then(() => peerConnection.createAnswer())
                .then(answer => peerConnection.setLocalDescription(answer))
                .then(() => {
                    socket.emit('webrtc_signal', {
                        to: data.from,
                        call_id: activeCall.id,
                        signal: peerConnection.localDescription
                    });
                });
        } else if (signal.type === 'answer') {
            peerConnection.setRemoteDescription(new RTCSessionDescription(signal));
        }
    }

    function handleCallIceCandidate(data) {
        if (!activeCall || activeCall.id !== data.call_id || !peerConnection) return;

        const candidate = new RTCIceCandidate(data.candidate);
        peerConnection.addIceCandidate(candidate);
    }

    function createPeerConnection() {
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        peerConnection = new RTCPeerConnection(configuration);

        peerConnection.onicecandidate = (event) => {
            if (event.candidate) {
                const recipient = activeCall.direction === 'outgoing' ? activeCall.callee : activeCall.caller;
                socket.emit('call_ice_candidate', {
                    to: recipient,
                    call_id: activeCall.id,
                    candidate: event.candidate
                });
            }
        };

        peerConnection.ontrack = (event) => {
            remoteStream = event.streams[0];
            if (remoteVideo) {
                remoteVideo.srcObject = remoteStream;
            }
        };

        peerConnection.onconnectionstatechange = () => {
            if (peerConnection.connectionState === 'failed') {
                endCall();
            }
        };
    }

    function showCallInterface(type) {
        if (!callModal) return;

        callModal.style.display = 'block';

        if (type === 'outgoing') {
            callTitle.textContent = '–ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫';
            callStatus.textContent = '–ó–≤–æ–Ω–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é...';
            callWith.textContent = currentRecipientName;
            acceptCallBtn.style.display = 'none';
            rejectCallBtn.style.display = 'none';
            endCallBtn.style.display = 'block';
            muteAudioBtn.style.display = 'none';
            muteVideoBtn.style.display = 'none';

            if (localStream && activeCall.type === 'video') {
                localVideo.srcObject = localStream;
                localVideo.style.display = 'block';
            } else {
                localVideo.style.display = 'none';
            }
            remoteVideo.style.display = 'none';

        } else if (type === 'incoming') {
            callTitle.textContent = '–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫';
            callStatus.textContent = '–í–∞–º –∑–≤–æ–Ω—è—Ç...';
            callWith.textContent = activeCall.caller;
            acceptCallBtn.style.display = 'block';
            rejectCallBtn.style.display = 'block';
            endCallBtn.style.display = 'none';
            muteAudioBtn.style.display = 'none';
            muteVideoBtn.style.display = 'none';

            localVideo.style.display = 'none';
            remoteVideo.style.display = 'none';

        } else if (type === 'active') {
            callTitle.textContent = '–ó–≤–æ–Ω–æ–∫';
            callStatus.textContent = '–†–∞–∑–≥–æ–≤–æ—Ä';
            callWith.textContent = activeCall.direction === 'outgoing' ? currentRecipientName : activeCall.caller;
            acceptCallBtn.style.display = 'none';
            rejectCallBtn.style.display = 'none';
            endCallBtn.style.display = 'block';
            muteAudioBtn.style.display = 'block';
            muteVideoBtn.style.display = activeCall.type === 'video' ? 'block' : 'none';

            if (localStream) {
                localVideo.srcObject = localStream;
                localVideo.style.display = activeCall.type === 'video' ? 'block' : 'none';
            }
            remoteVideo.style.display = activeCall.type === 'video' ? 'block' : 'none';

            startCallTimer();
        }
    }

    function startCallTimer() {
        callStartTime = Date.now();
        if (callTimer) clearInterval(callTimer);

        callTimer = setInterval(() => {
            const elapsed = Date.now() - callStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            const timerStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            if (callTimerElement) {
                callTimerElement.textContent = timerStr;
            }
        }, 1000);
    }

    function toggleMuteAudio() {
        if (!localStream) return;

        const audioTrack = localStream.getAudioTracks()[0];
        if (audioTrack) {
            audioTrack.enabled = !audioTrack.enabled;
            isMuted = !audioTrack.enabled;

            if (muteAudioBtn) {
                muteAudioBtn.innerHTML = isMuted ?
                    '<i class="fas fa-microphone-slash"></i>' :
                    '<i class="fas fa-microphone"></i>';
            }
        }
    }

    function toggleMuteVideo() {
        if (!localStream || activeCall.type !== 'video') return;

        const videoTrack = localStream.getVideoTracks()[0];
        if (videoTrack) {
            videoTrack.enabled = !videoTrack.enabled;
            isVideoMuted = !videoTrack.enabled;

            if (muteVideoBtn) {
                muteVideoBtn.innerHTML = isVideoMuted ?
                    '<i class="fas fa-video-slash"></i>' :
                    '<i class="fas fa-video"></i>';
            }
        }
    }

    function resetCall() {
        if (callTimer) {
            clearInterval(callTimer);
            callTimer = null;
        }

        callStartTime = null;

        if (localStream) {
            localStream.getTracks().forEach(track => track.stop());
            localStream = null;
        }

        if (remoteStream) {
            remoteStream.getTracks().forEach(track => track.stop());
            remoteStream = null;
        }

        if (peerConnection) {
            peerConnection.close();
            peerConnection = null;
        }

        activeCall = null;
        isMuted = false;
        isVideoMuted = false;

        if (callModal) {
            callModal.style.display = 'none';
        }
    }

    // ============ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============
    function updateOnlineStatus(username, isOnline) {
        const statusIndicator = document.getElementById(`status-${username}`);
        const headerStatusIndicator = document.getElementById(`header-status-${username}`);
        const headerStatusText = document.getElementById(`header-status-text-${username}`);

        if (statusIndicator) statusIndicator.classList.toggle('online', isOnline);
        if (headerStatusIndicator) headerStatusIndicator.classList.toggle('online', isOnline);
        if (headerStatusText) {
            const status = isOnline ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω';
            const iconColor = isOnline ? '#10b981' : '#94a3b8';
            headerStatusText.innerHTML = `<i class="fas fa-circle" style="color: ${iconColor}"></i> ${status}`;
        }

        updateOnlineCount();
    }

    function checkOnlineStatus(username) {
        fetch('/get_online_status')
            .then(response => response.json())
            .then(onlineUsers => {
                const userStatus = onlineUsers[username];
                if (userStatus) {
                    updateOnlineStatus(username, userStatus.online);
                }
            })
            .catch(console.error);
    }

    function updateOnlineCount() {
        const onlineItems = document.querySelectorAll('.status-indicator.online');
        const count = onlineItems.length;
        if (onlineCount) onlineCount.textContent = `${count}`;
    }

    function updateLastMessagePreview(message) {
        const contactItem = document.querySelector(`.contact-item[data-username="${message.sender}"]`);
        if (contactItem) {
            const previewElement = contactItem.querySelector('.contact-preview');
            if (previewElement) {
                let shortMessage = '';
                if (message.type === 'image') shortMessage = 'üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                else if (message.type === 'video') shortMessage = 'üé¨ –í–∏–¥–µ–æ';
                else if (message.type === 'sticker') shortMessage = 'üòä –°—Ç–∏–∫–µ—Ä';
                else shortMessage = message.message.length > 30 ? message.message.substring(0, 30) + '...' : message.message;

                previewElement.textContent = shortMessage;
            }
        }
    }

    function toggleBlockUser() {
        if (!currentRecipient) return;

        const isBlocked = confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @${currentRecipient}?`);

        if (isBlocked) {
            fetch('/api/block_user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username: currentRecipient })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showNotification(result.message, 'success');
                    updateChatHeader();
                    loadContacts();
                } else {
                    showNotification(result.message, 'error');
                }
            });
        }
    }

    function scrollToBottom() {
        if (messagesContainer) {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    }

    function playMessageSound() {
        try {
            const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
            audio.volume = 0.1;
            audio.play();
        } catch (e) {}
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;

        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-circle';

        notification.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;

        document.body.appendChild(notification);

        setTimeout(() => notification.classList.add('show'), 10);
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.parentNode?.removeChild(notification), 300);
        }, 3000);
    }

    function showNewMessageNotification(message) {
        showNotification(`–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${message.sender}`, 'info');
        playMessageSound();
    }

    function formatTime(timestamp) {
        if (!timestamp) return '';
        try {
            const date = new Date(timestamp);
            const now = new Date();

            if (date.toDateString() === now.toDateString()) {
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }

            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            if (date.toDateString() === yesterday.toDateString()) {
                return '–í—á–µ—Ä–∞';
            }

            const diff = now - date;
            if (diff < 7 * 24 * 60 * 60 * 1000) {
                const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                return days[date.getDay()];
            }

            return date.toLocaleDateString([], { day: '2-digit', month: '2-digit' });
        } catch (e) {
            return '';
        }
    }

    function formatDuration(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;

        if (hours > 0) {
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // ============ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ú–ï–î–ò–ê ============
    window.openMediaViewer = function(url, type) {
        const viewer = document.createElement('div');
        viewer.className = 'media-viewer';
        viewer.innerHTML = `
            <div class="media-viewer-content">
                <button class="close-viewer" onclick="window.closeMediaViewer()">
                    <i class="fas fa-times"></i>
                </button>
                ${type === 'image'
                    ? `<img src="${url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">`
                    : `<video controls autoplay>
                          <source src="${url}" type="video/mp4">
                       </video>`
                }
            </div>
        `;
        document.body.appendChild(viewer);
    };

    window.closeMediaViewer = function() {
        const viewer = document.querySelector('.media-viewer');
        if (viewer) {
            document.body.removeChild(viewer);
        }
    };

    // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
    initWebSocket();
    initSearch();
    initMessageForm();
    initCallSystem();

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    loadContacts();

    // –ö–ª–∏–∫–∏ –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º
    if (contactsList) {
        contactsList.addEventListener('click', (e) => {
            const contactItem = e.target.closest('.contact-item');
            if (contactItem) {
                const username = contactItem.dataset.username;
                const name = contactItem.querySelector('h4').textContent;
                const color = contactItem.dataset.color || '#4ECDC4';
                openChat(username, name, color);
            }
        });
    }

    // –ö–Ω–æ–ø–∫–∞ "–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    const startNewChatBtn = document.getElementById('start-new-chat');
    if (startNewChatBtn) {
        startNewChatBtn.addEventListener('click', () => {
            if (searchInput) searchInput.focus();
        });
    }

    console.log('Kildear Messenger –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
});

Js stickers.js

// static/stickers.js
const stickers = {
    'emotions': [
        { id: 'smile', emoji: 'üòä', text: '–£–ª—ã–±–∫–∞' },
        { id: 'laugh', emoji: 'üòÇ', text: '–°–º–µ—Ö' },
        { id: 'love', emoji: 'üòç', text: '–õ—é–±–æ–≤—å' },
        { id: 'wink', emoji: 'üòâ', text: '–ü–æ–¥–º–∏–≥–∏–≤–∞–Ω–∏–µ' },
        { id: 'cool', emoji: 'üòé', text: '–ö—Ä—É—Ç–æ–π' },
        { id: 'sad', emoji: 'üò¢', text: '–ì—Ä—É—Å—Ç—å' },
        { id: 'angry', emoji: 'üò†', text: '–ó–ª–æ—Å—Ç—å' },
        { id: 'surprise', emoji: 'üò≤', text: '–£–¥–∏–≤–ª–µ–Ω–∏–µ' },
        { id: 'thinking', emoji: 'ü§î', text: '–†–∞–∑–º—ã—à–ª–µ–Ω–∏–µ' },
        { id: 'facepalm', emoji: 'ü§¶', text: '–†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ' }
    ],
    'animals': [
        { id: 'cat', emoji: 'üê±', text: '–ö–æ—Ç' },
        { id: 'dog', emoji: 'üê∂', text: '–°–æ–±–∞–∫–∞' },
        { id: 'fox', emoji: 'ü¶ä', text: '–õ–∏—Å–∞' },
        { id: 'lion', emoji: 'ü¶Å', text: '–õ–µ–≤' },
        { id: 'tiger', emoji: 'üêØ', text: '–¢–∏–≥—Ä' },
        { id: 'bear', emoji: 'üêª', text: '–ú–µ–¥–≤–µ–¥—å' },
        { id: 'panda', emoji: 'üêº', text: '–ü–∞–Ω–¥–∞' },
        { id: 'rabbit', emoji: 'üê∞', text: '–ö—Ä–æ–ª–∏–∫' },
        { id: 'owl', emoji: 'ü¶â', text: '–°–æ–≤–∞' },
        { id: 'unicorn', emoji: 'ü¶Ñ', text: '–ï–¥–∏–Ω–æ—Ä–æ–≥' }
    ],
    'actions': [
        { id: 'thumbs_up', emoji: 'üëç', text: '–ö–ª–∞—Å—Å' },
        { id: 'thumbs_down', emoji: 'üëé', text: '–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è' },
        { id: 'ok', emoji: 'üëå', text: '–û–ö' },
        { id: 'clap', emoji: 'üëè', text: '–ê–ø–ª–æ–¥–∏—Å–º–µ–Ω—Ç—ã' },
        { id: 'pray', emoji: 'üôè', text: '–ú–æ–ª–∏—Ç–≤–∞' },
        { id: 'fist', emoji: '‚úä', text: '–ö—É–ª–∞–∫' },
        { id: 'wave', emoji: 'üëã', text: '–ü—Ä–∏–≤–µ—Ç' },
        { id: 'heart', emoji: '‚ù§Ô∏è', text: '–°–µ—Ä–¥—Ü–µ' },
        { id: 'fire', emoji: 'üî•', text: '–û–≥–æ–Ω—å' },
        { id: 'star', emoji: '‚≠ê', text: '–ó–≤–µ–∑–¥–∞' }
    ],
    'objects': [
        { id: 'coffee', emoji: '‚òï', text: '–ö–æ—Ñ–µ' },
        { id: 'pizza', emoji: 'üçï', text: '–ü–∏—Ü—Ü–∞' },
        { id: 'beer', emoji: 'üç∫', text: '–ü–∏–≤–æ' },
        { id: 'cake', emoji: 'üéÇ', text: '–¢–æ—Ä—Ç' },
        { id: 'gift', emoji: 'üéÅ', text: '–ü–æ–¥–∞—Ä–æ–∫' },
        { id: 'balloon', emoji: 'üéà', text: '–®–∞—Ä–∏–∫' },
        { id: 'music', emoji: 'üéµ', text: '–ú—É–∑—ã–∫–∞' },
        { id: 'camera', emoji: 'üì∑', text: '–ö–∞–º–µ—Ä–∞' },
        { id: 'phone', emoji: 'üì±', text: '–¢–µ–ª–µ—Ñ–æ–Ω' },
        { id: 'money', emoji: 'üí∞', text: '–î–µ–Ω—å–≥–∏' }
    ]
};

function initStickers() {
    const stickerBtn = document.createElement('button');
    stickerBtn.className = 'btn-icon';
    stickerBtn.id = 'stickers-btn';
    stickerBtn.title = '–°—Ç–∏–∫–µ—Ä—ã';
    stickerBtn.innerHTML = '<i class="fas fa-sticky-note"></i>';

    const attachmentButtons = document.querySelector('.attachment-buttons');
    if (attachmentButtons) {
        attachmentButtons.appendChild(stickerBtn);
    }

    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç–∏–∫–µ—Ä–æ–≤
    const stickersContainer = document.createElement('div');
    stickersContainer.id = 'stickers-container';
    stickersContainer.className = 'stickers-container';
    stickersContainer.style.display = 'none';

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    const header = document.createElement('div');
    header.className = 'stickers-header';
    header.innerHTML = `
        <h4><i class="fas fa-sticky-note"></i> –°—Ç–∏–∫–µ—Ä—ã</h4>
        <button class="btn-icon close-stickers">
            <i class="fas fa-times"></i>
        </button>
    `;
    stickersContainer.appendChild(header);

    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
    const categories = document.createElement('div');
    categories.className = 'sticker-categories';

    Object.keys(stickers).forEach(category => {
        const btn = document.createElement('button');
        btn.className = 'sticker-category-btn';
        btn.dataset.category = category;
        btn.textContent = getCategoryName(category);
        categories.appendChild(btn);
    });
    stickersContainer.appendChild(categories);

    // –°–µ—Ç–∫–∞ —Å—Ç–∏–∫–µ—Ä–æ–≤
    const grid = document.createElement('div');
    grid.className = 'stickers-grid';
    stickersContainer.appendChild(grid);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM
    const messageInputContainer = document.querySelector('.message-input-container');
    if (messageInputContainer) {
        messageInputContainer.appendChild(stickersContainer);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    stickerBtn.addEventListener('click', toggleStickers);

    if (stickersContainer.querySelector('.close-stickers')) {
        stickersContainer.querySelector('.close-stickers').addEventListener('click', () => {
            stickersContainer.style.display = 'none';
        });
    }

    categories.addEventListener('click', (e) => {
        if (e.target.classList.contains('sticker-category-btn')) {
            const category = e.target.dataset.category;
            showStickers(category);

            // –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
            categories.querySelectorAll('.sticker-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');
        }
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    showStickers('emotions');
    const firstCategoryBtn = categories.querySelector('[data-category="emotions"]');
    if (firstCategoryBtn) {
        firstCategoryBtn.classList.add('active');
    }
}

function toggleStickers() {
    const container = document.getElementById('stickers-container');
    if (!container) return;

    if (container.style.display === 'none' || !container.style.display) {
        container.style.display = 'block';
    } else {
        container.style.display = 'none';
    }
}

function showStickers(category) {
    const grid = document.querySelector('.stickers-grid');
    if (!grid) return;

    grid.innerHTML = '';

    if (stickers[category]) {
        stickers[category].forEach(sticker => {
            const stickerEl = document.createElement('div');
            stickerEl.className = 'sticker-item';
            stickerEl.title = sticker.text;
            stickerEl.innerHTML = `
                <div class="sticker-emoji">${sticker.emoji}</div>
                <div class="sticker-text">${sticker.text}</div>
            `;

            stickerEl.addEventListener('click', () => {
                sendSticker(sticker.emoji);
                const container = document.getElementById('stickers-container');
                if (container) {
                    container.style.display = 'none';
                }
            });

            grid.appendChild(stickerEl);
        });
    }
}

function getCategoryName(category) {
    const names = {
        'emotions': '–≠–º–æ—Ü–∏–∏',
        'animals': '–ñ–∏–≤–æ—Ç–Ω—ã–µ',
        'actions': '–î–µ–π—Å—Ç–≤–∏—è',
        'objects': '–û–±—ä–µ–∫—Ç—ã'
    };
    return names[category] || category;
}

function sendSticker(emoji) {
    const currentRecipient = document.getElementById('current-recipient')?.value;
    if (!currentRecipient) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∏–∫–µ—Ä–∞', 'info');
        return;
    }

    const socket = io();
    const messageData = {
        recipient: currentRecipient,
        message: emoji,
        type: 'sticker'
    };

    const sendBtn = document.querySelector('.btn-send');

    if (sendBtn) {
        const originalIcon = sendBtn.innerHTML;
        sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        sendBtn.disabled = true;

        socket.emit('send_message', messageData, (response) => {
            sendBtn.innerHTML = originalIcon;
            sendBtn.disabled = false;

            if (response && response.error) {
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + response.error, 'error');
            }
        });
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;

    let icon = 'info-circle';
    if (type === 'success') icon = 'check-circle';
    if (type === 'error') icon = 'exclamation-circle';

    notification.innerHTML = `
        <i class="fas fa-${icon}"></i>
        <span>${message}</span>
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
        notification.classList.add('show');
    }, 10);

    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', initStickers);

style.css

/* –°–±—Ä–æ—Å –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
    --primary-color: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;

    --secondary-color: #8b5cf6;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --info-color: #3b82f6;

    --bg-dark: #0f172a;
    --bg-darker: #0a0f1f;
    --bg-card: #1e293b;
    --bg-input: #334155;
    --bg-hover: #2d3748;

    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;

    --border-color: #475569;
    --border-light: #64748b;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);

    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-full: 9999px;

    --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

body.light-theme {
    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    --primary-color: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;

    --secondary-color: #8b5cf6;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --info-color: #3b82f6;

    --bg-dark: #f8fafc;
    --bg-darker: #f1f5f9;
    --bg-card: #ffffff;
    --bg-input: #f1f5f9;
    --bg-hover: #e2e8f0;

    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-muted: #94a3b8;

    --border-color: #e2e8f0;
    --border-light: #cbd5e1;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    min-height: 100vh;
    transition: var(--transition);
}

/* –°—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
.auth-page {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 1rem;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

.auth-container {
    width: 100%;
    max-width: 440px;
}

.auth-card {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    padding: 2.5rem;
    box-shadow: var(--shadow-lg);
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.auth-header {
    text-align: center;
    margin-bottom: 2rem;
}

.logo {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1.5rem;
}

.logo i {
    font-size: 2rem;
}

.auth-header h1 {
    font-size: 1.75rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.auth-header p {
    color: var(--text-secondary);
    font-size: 0.9375rem;
}

.alert {
    padding: 1rem;
    border-radius: var(--radius-md);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.alert-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #fca5a5;
}

.alert-success {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
    color: #34d399;
}

.alert-info {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    color: #93c5fd;
}

.auth-form {
    margin-bottom: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
    font-weight: 500;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 0.875rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
    font-family: 'Inter', sans-serif;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    background: var(--bg-card);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.form-group input[type="password"] {
    letter-spacing: 0.1em;
}

.input-with-prefix {
    display: flex;
    align-items: center;
}

.input-with-prefix .prefix {
    background: var(--bg-input);
    padding: 0.875rem 1rem;
    border: 2px solid var(--border-color);
    border-right: none;
    border-radius: var(--radius-md) 0 0 var(--radius-md);
    color: var(--text-secondary);
    font-size: 0.9375rem;
    font-weight: 500;
}

.input-with-prefix input {
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
}

.form-hint {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.375rem;
}

.btn {
    padding: 0.875rem 1.5rem;
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.9375rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-family: 'Inter', sans-serif;
}

.btn-block {
    width: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    position: relative;
    overflow: hidden;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn-primary::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.btn-primary:hover::after {
    left: 100%;
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--border-color);
    color: var(--text-primary);
}

.btn-outline:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    background: rgba(99, 102, 241, 0.05);
}

.btn-danger {
    background: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background: #dc2626;
    transform: translateY(-2px);
}

.btn-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: var(--radius-full);
    border: none;
    background: var(--bg-input);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.btn-icon:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.auth-footer {
    text-align: center;
    padding-top: 1.5rem;
    margin-top: 1.5rem;
    border-top: 1px solid var(--border-color);
}

.auth-footer p {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
}

.link:hover {
    text-decoration: underline;
}

.security-info,
.demo-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    margin-top: 1.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.security-info i {
    color: var(--success-color);
}

.demo-info i {
    color: var(--info-color);
}

/* –ß–∞—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
.chat-app {
    display: flex;
    height: 100vh;
    background: var(--bg-dark);
}

/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
.sidebar {
    width: 380px;
    background: var(--bg-card);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    transition: var(--transition);
}

.sidebar-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.user-profile {
    flex: 1;
}

.user-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    text-decoration: none;
    color: inherit;
    transition: var(--transition);
}

.user-link:hover {
    opacity: 0.9;
}

.user-avatar {
    width: 3rem;
    height: 3rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 1.25rem;
    position: relative;
    overflow: hidden;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-info h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.user-status {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--text-secondary);
}

.user-status.online {
    color: var(--success-color);
}

.user-status i {
    font-size: 0.5rem;
}

.sidebar-actions {
    display: flex;
    gap: 0.5rem;
}

.search-container {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    position: relative;
}

.search-box {
    position: relative;
    display: flex;
    align-items: center;
}

.search-box i {
    position: absolute;
    left: 1rem;
    color: var(--text-muted);
    font-size: 0.875rem;
}

.search-box input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 0.875rem;
    transition: var(--transition);
}

.search-box input:focus {
    outline: none;
    background: var(--bg-card);
    border-color: var(--primary-color);
}

.search-results {
    position: absolute;
    top: 100%;
    left: 1.5rem;
    right: 1.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    margin-top: 0.5rem;
    max-height: 320px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.no-results {
    padding: 2rem 1rem;
    text-align: center;
    color: var(--text-muted);
    font-size: 0.875rem;
}

.contacts-container {
    flex: 1;
    overflow-y: auto;
}

.contacts-header {
    padding: 1.25rem 1.5rem 0.75rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.contacts-header h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.badge {
    padding: 0.25rem 0.75rem;
    background: var(--primary-color);
    color: white;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 500;
}

.contacts-list {
    display: flex;
    flex-direction: column;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: var(--transition);
    border-bottom: 1px solid var(--border-color);
    position: relative;
}

.contact-item:hover {
    background: var(--bg-hover);
}

.contact-item.active {
    background: var(--bg-input);
    border-left: 3px solid var(--primary-color);
}

.contact-avatar {
    width: 2.75rem;
    height: 2.75rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 1rem;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.contact-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.status-indicator {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 0.75rem;
    height: 0.75rem;
    border-radius: var(--radius-full);
    background: var(--text-muted);
    border: 2px solid var(--bg-card);
    transition: var(--transition);
}

.status-indicator.online {
    background: var(--success-color);
    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
}

.contact-info {
    flex: 1;
    min-width: 0;
}

.contact-name-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.25rem;
}

.contact-name-row h4 {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.message-time {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.contact-preview {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-dark);
}

.chat-header {
    padding: 1.5rem 2rem;
    background: var(--bg-card);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.chat-actions {
    display: flex;
    gap: 0.5rem;
}

.empty-chat {
    text-align: center;
    padding: 3rem 1rem;
}

.empty-icon {
    font-size: 4rem;
    color: var(--primary-color);
    opacity: 0.2;
    margin-bottom: 1.5rem;
}

.empty-chat h2 {
    font-size: 1.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

.empty-chat p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
    font-size: 1rem;
}

.empty-contacts {
    padding: 3rem 1rem;
    text-align: center;
    color: var(--text-secondary);
}

.empty-contacts .empty-icon {
    font-size: 3rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
    opacity: 0.5;
}

.messages-container {
    flex: 1;
    padding: 1.5rem 2rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: var(--bg-dark);
}

.message {
    display: flex;
    max-width: 65%;
    animation: messageAppear 0.3s ease;
}

@keyframes messageAppear {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message.incoming {
    align-self: flex-start;
}

.message.outgoing {
    align-self: flex-end;
    flex-direction: row-reverse;
}

.message-avatar {
    width: 2.25rem;
    height: 2.25rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 0.875rem;
    flex-shrink: 0;
    margin-top: auto;
}

.message.incoming .message-avatar {
    margin-right: 0.75rem;
}

.message.outgoing .message-avatar {
    margin-left: 0.75rem;
}

.message-content {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
}

.message-bubble {
    padding: 0.75rem 1rem;
    border-radius: var(--radius-lg);
    font-size: 0.9375rem;
    line-height: 1.4;
    word-break: break-word;
    position: relative;
    max-width: 100%;
}

.message.incoming .message-bubble {
    background: var(--bg-card);
    border-bottom-left-radius: var(--radius-sm);
    color: var(--text-primary);
    box-shadow: var(--shadow-sm);
}

.message.outgoing .message-bubble {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-bottom-right-radius: var(--radius-sm);
    color: white;
}

.message-text {
    word-wrap: break-word;
}

.message-media {
    margin: 0.5rem 0;
    border-radius: var(--radius-md);
    overflow: hidden;
}

.message-media img,
.message-media video {
    max-width: 300px;
    max-height: 300px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: transform 0.2s ease;
    display: block;
}

.message-media img:hover {
    transform: scale(1.02);
}

.message-media video {
    background: #000;
}

.media-caption {
    margin-top: 0.5rem;
    padding: 0.5rem 0;
    color: inherit;
    font-size: 0.9375rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.message.outgoing .media-caption {
    border-top-color: rgba(255, 255, 255, 0.2);
}

.message-time {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: right;
}

.message-input-container {
    padding: 1.5rem 2rem;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.typing-indicator {
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    animation: typingPulse 1.5s infinite;
}

@keyframes typingPulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

.message-input-wrapper {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
}

.attachment-buttons {
    display: flex;
    gap: 0.5rem;
}

#message-form {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

#message-input {
    flex: 1;
    padding: 0.875rem 1.25rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
}

#message-input:focus {
    outline: none;
    background: var(--bg-card);
    border-color: var(--primary-color);
}

.btn-send {
    width: 3rem;
    height: 3rem;
    padding: 0;
    border-radius: var(--radius-full);
    font-size: 1.125rem;
}

/* –ü—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏–π */
.attachment-preview {
    margin-top: 0.5rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    border: 2px dashed var(--border-color);
    display: none;
}

.preview-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.preview-content {
    flex: 1;
    display: flex;
    gap: 1rem;
    align-items: center;
}

.preview-image img,
.preview-video video {
    max-width: 150px;
    max-height: 150px;
    border-radius: var(--radius-md);
    object-fit: cover;
}

.preview-video video {
    background: #000;
}

.preview-info {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.btn-remove-attachment {
    background: var(--danger-color);
    color: white;
}

.btn-remove-attachment:hover {
    background: #dc2626;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
.call-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.9);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.call-modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

.call-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
}

.call-modal-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

#call-timer {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-left: 0.5rem;
}

.call-modal-body {
    padding: 2rem 1.5rem;
    text-align: center;
}

.calling-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.calling-dots {
    display: flex;
    gap: 0.5rem;
}

.calling-dots .dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: var(--primary-color);
    animation: dotPulse 1.4s ease-in-out infinite;
}

.calling-dots .dot:nth-child(1) { animation-delay: -0.32s; }
.calling-dots .dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes dotPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

.incoming-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.caller-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.caller-avatar {
    width: 5rem;
    height: 5rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 600;
    color: white;
}

.caller-details {
    text-align: center;
}

.caller-details h4 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
}

.caller-details p {
    color: var(--text-secondary);
}

.video-container {
    position: relative;
    width: 100%;
    height: 300px;
    margin: 1rem 0;
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--bg-darker);
}

#local-video {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    width: 120px;
    height: 90px;
    border-radius: var(--radius-md);
    object-fit: cover;
    border: 2px solid var(--border-color);
    z-index: 1;
}

#remote-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.call-controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
}

.call-controls .btn-icon {
    width: 3.5rem;
    height: 3.5rem;
    font-size: 1.25rem;
}

.call-controls .btn-danger {
    background: var(--danger-color);
    color: white;
}

.call-controls .btn-danger:hover {
    background: #dc2626;
}

.active-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.active-call p {
    font-size: 1.125rem;
    color: var(--text-primary);
}

.call-modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: center;
    gap: 1rem;
}

/* –ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –º–µ–¥–∏–∞ */
.media-viewer {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.media-viewer-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
}

.media-viewer-content img,
.media-viewer-content video {
    max-width: 100%;
    max-height: 90vh;
    border-radius: var(--radius-lg);
}

.media-viewer-content video {
    background: #000;
}

.close-viewer {
    position: absolute;
    top: -3rem;
    right: 0;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 3rem;
    height: 3rem;
    border-radius: var(--radius-full);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition);
}

.close-viewer:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è */
.profile-page {
    min-height: 100vh;
    background: var(--bg-dark);
    padding: 1rem;
}

.profile-nav {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.9375rem;
    font-weight: 500;
    transition: var(--transition);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-md);
}

.back-btn:hover {
    color: var(--primary-color);
    background: var(--bg-input);
}

.profile-nav h1 {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--text-primary);
}

.profile-content {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
}

.profile-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: var(--transition);
}

.profile-card:hover {
    box-shadow: var(--shadow-md);
}

.avatar-section {
    text-align: center;
    margin-bottom: 1.5rem;
}

.avatar-preview {
    width: 8rem;
    height: 8rem;
    border-radius: var(--radius-full);
    margin: 0 auto 1rem;
    border: 4px solid var(--primary-color);
    overflow: hidden;
    position: relative;
}

.avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 600;
    color: white;
}

.avatar-actions {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 1rem;
}

.user-info {
    text-align: center;
    margin-bottom: 1.5rem;
}

.user-info h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.username {
    color: var(--text-secondary);
    font-size: 0.9375rem;
    margin-bottom: 1rem;
}

.description {
    color: var(--text-primary);
    font-size: 0.9375rem;
    line-height: 1.5;
    margin-bottom: 1.5rem;
}

.user-stats {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1.5rem;
}

.stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
}

.stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.stat-value {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã */
.theme-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

.theme-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition);
}

.theme-option:hover {
    border-color: var(--primary-light);
}

.theme-option.active {
    border-color: var(--primary-color);
    background: rgba(99, 102, 241, 0.05);
}

.theme-preview {
    width: 100%;
    height: 5rem;
    border-radius: var(--radius-md);
    overflow: hidden;
    position: relative;
}

.theme-preview.dark {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
}

.theme-preview.light {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.preview-header {
    height: 1.5rem;
    background: rgba(0, 0, 0, 0.1);
}

.preview-body {
    height: calc(100% - 1.5rem);
    padding: 0.5rem;
}

.theme-preview.dark .preview-body::before,
.theme-preview.light .preview-body::before {
    content: '';
    display: block;
    width: 60%;
    height: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-sm);
    margin-bottom: 0.25rem;
}

.theme-preview.light .preview-body::before {
    background: rgba(0, 0, 0, 0.1);
}

.theme-option span {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
}

/* –§–æ—Ä–º—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
.profile-card h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.profile-card h3 i {
    color: var(--primary-color);
}

#edit-profile-form,
#change-password-form,
#change-username-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.danger-zone {
    border-color: rgba(239, 68, 68, 0.3);
    background: rgba(239, 68, 68, 0.05);
}

.danger-zone h3 {
    color: var(--danger-color);
}

.danger-zone p {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
}

.danger-actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.notification {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: var(--shadow-lg);
    z-index: 9999;
    transform: translateX(120%);
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border-left: 4px solid var(--primary-color);
    max-width: 400px;
}

.notification.show {
    transform: translateX(0);
}

.notification.success {
    border-left-color: var(--success-color);
}

.notification.error {
    border-left-color: var(--danger-color);
}

.notification.info {
    border-left-color: var(--info-color);
}

.notification i {
    font-size: 1.25rem;
}

.notification.success i {
    color: var(--success-color);
}

.notification.error i {
    color: var(--danger-color);
}

.notification.info i {
    color: var(--info-color);
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.notification-message {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.notification-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    font-size: 1rem;
    transition: var(--transition);
}

.notification-close:hover {
    color: var(--text-primary);
}

/* –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é */
.mobile-menu {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: space-around;
    padding: 0.75rem;
    z-index: 1000;
    display: none;
}

.mobile-menu-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.75rem;
    padding: 0.5rem;
    border-radius: var(--radius-md);
    transition: var(--transition);
}

.mobile-menu-item.active,
.mobile-menu-item:hover {
    color: var(--primary-color);
    background: var(--bg-input);
}

.mobile-menu-item i {
    font-size: 1.25rem;
}

/* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-input);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .profile-content {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .profile-left,
    .profile-right {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .chat-app {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
    }

    .contacts-container {
        max-height: 300px;
    }

    .profile-content {
        padding: 0.5rem;
    }

    .profile-nav {
        padding: 0.5rem;
    }

    .notification {
        left: 1rem;
        right: 1rem;
        max-width: none;
    }

    .mobile-menu {
        display: flex;
    }

    .call-modal-content {
        width: 95%;
        margin: 1rem;
    }

    .video-container {
        height: 200px;
    }

    #local-video {
        width: 80px;
        height: 60px;
    }
}

@media (max-width: 480px) {
    .auth-card {
        padding: 1.5rem;
    }

    .logo {
        font-size: 1.5rem;
    }

    .logo i {
        font-size: 1.75rem;
    }

    .auth-header h1 {
        font-size: 1.5rem;
    }

    .theme-selector {
        grid-template-columns: 1fr;
    }

    .message {
        max-width: 85%;
    }

    .call-controls {
        gap: 0.5rem;
    }

    .call-controls .btn-icon {
        width: 3rem;
        height: 3rem;
    }
}

/* –ó–∞–≥—Ä—É–∑—á–∏–∫ */
.loader {
    display: inline-block;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--border-color);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(4px);
}

.loading-spinner {
    width: 3rem;
    height: 3rem;
    border: 3px solid var(--border-color);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s linear infinite;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.pulse {
    animation: pulse 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.bounce {
    animation: bounce 2s infinite;
}
/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
.btn-send:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.fa-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–µ–¥–∏–∞ */
.message-media {
    position: relative;
    max-width: 300px;
    margin: 0.5rem 0;
}

.message-media img {
    max-width: 100%;
    max-height: 300px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: transform 0.2s ease;
    display: block;
}

.message-media video {
    max-width: 100%;
    max-height: 300px;
    border-radius: var(--radius-md);
    background: #000;
    cursor: pointer;
}

.message-media img:hover {
    transform: scale(1.02);
}

.media-caption {
    margin-top: 0.5rem;
    padding: 0.5rem 0;
    color: inherit;
    font-size: 0.9375rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.message.outgoing .media-caption {
    border-top-color: rgba(255, 255, 255, 0.2);
}

/* –ü—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏—è */
.attachment-preview {
    margin-top: 0.5rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    border: 2px dashed var(--border-color);
    display: none;
}

.preview-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.preview-content {
    flex: 1;
    display: flex;
    gap: 1rem;
    align-items: center;
}

.preview-image img,
.preview-video video {
    max-width: 150px;
    max-height: 150px;
    border-radius: var(--radius-md);
    object-fit: cover;
}

.preview-video video {
    background: #000;
}

.preview-info {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.btn-remove-attachment {
    background: var(--danger-color);
    color: white;
}

.btn-remove-attachment:hover {
    background: #dc2626;
}

/* –°–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ */
.upload-progress {
    width: 100%;
    height: 4px;
    background: var(--border-color);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.upload-progress-bar {
    height: 100%;
    background: var(--primary-color);
    transition: width 0.3s ease;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message {
    animation: fadeIn 0.3s ease;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–µ–¥–∏–∞ */
@media (max-width: 768px) {
    .message-media {
        max-width: 250px;
    }

    .message-media img,
    .message-media video {
        max-height: 250px;
    }
}

@media (max-width: 480px) {
    .message-media {
        max-width: 200px;
    }

    .message-media img,
    .message-media video {
        max-height: 200px;
    }

    .preview-image img,
    .preview-video video {
        max-width: 100px;
        max-height: 100px;
    }
}
/* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
.context-menu {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    min-width: 180px;
    z-index: 10000;
    overflow: hidden;
}

.context-menu-content {
    padding: 0.25rem 0;
}

.context-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.context-menu-item:hover {
    background: var(--bg-input);
}

.context-menu-item i {
    width: 1rem;
    text-align: center;
    color: var(--text-secondary);
}

/* –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –≤ –ø–æ–∏—Å–∫–µ */
.search-result {
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
}

.search-result:hover {
    background: var(--bg-hover);
}

.user-status-badge {
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius-full);
    font-weight: 500;
}

.user-status-badge.online {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-color);
}

.user-status-badge.offline {
    background: rgba(148, 163, 184, 0.2);
    color: var(--text-secondary);
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.message-bubble {
    position: relative;
}

.message-bubble:hover::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.03);
    pointer-events: none;
    border-radius: var(--radius-lg);
}

.message.outgoing .message-bubble:hover::after {
    background: rgba(255, 255, 255, 0.05);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
@keyframes messageAppear {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message {
    animation: messageAppear 0.3s ease;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
.messages-container::-webkit-scrollbar {
    width: 8px;
}

.messages-container::-webkit-scrollbar-track {
    background: transparent;
}

.messages-container::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

.messages-container::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é */
@media (max-width: 768px) {
    .context-menu {
        min-width: 160px;
        font-size: 0.8125rem;
    }

    .context-menu-item {
        padding: 0.625rem 0.875rem;
    }
}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.btn-icon:active {
    transform: scale(0.95);
}

.message-avatar {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.message-avatar:hover {
    transform: scale(1.05);
}

.contact-item.active .contact-avatar {
    border: 2px solid var(--primary-color);
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
.new-message-indicator {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 12px;
    height: 12px;
    background: var(--danger-color);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.7;
        transform: scale(1.1);
    }
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ */
.search-box {
    position: relative;
}

.search-box:focus-within {
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.search-results {
    max-height: 400px;
    overflow-y: auto;
}

.search-results::-webkit-scrollbar {
    width: 6px;
}

.search-results::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —á–∞—Ç–∞ */
.chat-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    color: var(--text-secondary);
}

.chat-loading .loader {
    width: 2rem;
    height: 2rem;
    border-width: 3px;
    margin-bottom: 1rem;
}
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
.users-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    max-height: 500px;
    overflow-y: auto;
}

.user-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    transition: var(--transition);
}

.user-item:hover {
    border-color: var(--primary-color);
    background: var(--bg-hover);
}

.user-item .user-avatar {
    width: 3rem;
    height: 3rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.user-item .user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-info {
    flex: 1;
    min-width: 0;
}

.user-name-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.25rem;
}

.user-name-row h4 {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--text-primary);
}

.user-username {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.user-description {
    font-size: 0.8125rem;
    color: var(--text-primary);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.user-actions {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
}

.modal-content {
    max-width: 600px;
    width: 90%;
}
/* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
.context-menu {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    min-width: 180px;
    z-index: 10000;
    overflow: hidden;
    animation: fadeIn 0.15s ease;
}

.context-menu-content {
    padding: 0.25rem 0;
}

.context-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-primary);
    font-size: 0.875rem;
    user-select: none;
}

.context-menu-item:hover {
    background: var(--bg-input);
}

.context-menu-item i {
    width: 1rem;
    text-align: center;
    color: var(--text-secondary);
}

/* –ü–æ–∏—Å–∫ */
.search-result {
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
}

.search-result:hover {
    background: var(--bg-hover);
}

.no-results {
    padding: 1.5rem;
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.user-status-badge {
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius-full);
    font-weight: 500;
    white-space: nowrap;
}

.user-status-badge.online {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-color);
}

.user-status-badge.offline {
    background: rgba(148, 163, 184, 0.2);
    color: var(--text-secondary);
}

/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.2s ease;
}

.modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow-lg);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.modal-body {
    padding: 1.5rem;
    flex: 1;
    overflow-y: auto;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

/* Forward dialog specific */
.forward-message-preview {
    background: var(--bg-input);
    border-radius: var(--radius-md);
    padding: 1rem;
    margin-bottom: 1rem;
}

.message-preview {
    font-size: 0.875rem;
}

.message-preview strong {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.message-preview p {
    color: var(--text-secondary);
    line-height: 1.4;
}

.search-recipient {
    position: relative;
}

.search-recipient input {
    width: 100%;
    padding: 0.875rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
}

.search-recipient input:focus {
    outline: none;
    border-color: var(--primary-color);
    background: var(--bg-card);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.message {
    animation: fadeIn 0.3s ease;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
.fa-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

/* –ü—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞ */
.reply-preview {
    background: var(--bg-input);
    border-radius: var(--radius-md);
    margin: 0 2rem 0.5rem;
    border-left: 3px solid var(--primary-color);
    position: relative;
}

.reply-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

.reply-preview-header span {
    font-size: 0.75rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.reply-preview-content {
    padding: 0.75rem 1rem;
}

.reply-preview-content strong {
    display: block;
    margin-bottom: 0.25rem;
    color: var(--primary-color);
    font-size: 0.875rem;
}

.reply-preview-content p {
    font-size: 0.875rem;
    color: var(--text-primary);
    line-height: 1.4;
    margin: 0;
}

/* Forward label in messages */
.forward-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.forward-label i {
    font-size: 0.625rem;
}

/* Edit label in messages */
.edit-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.edit-label i {
    font-size: 0.625rem;
}

/* –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
.edit-message-container {
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    animation: slideInUp 0.3s ease;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.edit-message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.edit-message-header span {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

#edit-message-form {
    display: flex;
    align-items: center;
    gap: 1rem;
}

#edit-message-input {
    flex: 1;
    padding: 0.875rem 1.25rem;
    background: var(--bg-input);
    border: 2px solid var(--primary-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
}

#edit-message-input:focus {
    outline: none;
    background: var(--bg-card);
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
.search-results::-webkit-scrollbar,
.messages-container::-webkit-scrollbar,
.modal-body::-webkit-scrollbar {
    width: 6px;
}

.search-results::-webkit-scrollbar-track,
.messages-container::-webkit-scrollbar-track,
.modal-body::-webkit-scrollbar-track {
    background: transparent;
}

.search-results::-webkit-scrollbar-thumb,
.messages-container::-webkit-scrollbar-thumb,
.modal-body::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

.search-results::-webkit-scrollbar-thumb:hover,
.messages-container::-webkit-scrollbar-thumb:hover,
.modal-body::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .context-menu {
        min-width: 160px;
        font-size: 0.8125rem;
    }

    .context-menu-item {
        padding: 0.625rem 0.875rem;
    }

    .reply-preview {
        margin: 0 1rem 0.5rem;
    }

    .modal-content {
        width: 95%;
        margin: 1rem;
    }
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
.call-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.95);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.call-modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

.call-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
}

.call-modal-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

#call-timer {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-left: 0.5rem;
}

.call-modal-body {
    padding: 2rem 1.5rem;
    text-align: center;
}

.calling-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.calling-dots {
    display: flex;
    gap: 0.5rem;
}

.calling-dots .dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: var(--primary-color);
    animation: dotPulse 1.4s ease-in-out infinite;
}

.calling-dots .dot:nth-child(1) { animation-delay: -0.32s; }
.calling-dots .dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes dotPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

.incoming-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.caller-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.caller-avatar {
    width: 5rem;
    height: 5rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 600;
    color: white;
}

.caller-details {
    text-align: center;
}

.caller-details h4 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
}

.caller-details p {
    color: var(--text-secondary);
}

.active-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.active-call p {
    font-size: 1.125rem;
    color: var(--text-primary);
}

.video-placeholder, .audio-placeholder {
    width: 200px;
    height: 200px;
    border-radius: var(--radius-xl);
    background: var(--bg-input);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin: 1rem auto;
}

.video-placeholder i, .audio-placeholder i {
    font-size: 3rem;
    color: var(--primary-color);
}

.video-placeholder p, .audio-placeholder p {
    color: var(--text-secondary);
}

.call-modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: center;
    gap: 1rem;
}

@media (max-width: 768px) {
    .call-modal-content {
        width: 95%;
        margin: 1rem;
    }
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
.call-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.95);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.call-modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.call-header {
    padding: 1.5rem;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
}

.call-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.call-timer {
    font-size: 1.25rem;
    color: var(--primary-color);
    font-weight: 500;
    font-family: monospace;
}

.call-body {
    padding: 2rem;
    text-align: center;
}

.video-container {
    position: relative;
    width: 100%;
    height: 300px;
    background: var(--bg-darker);
    border-radius: var(--radius-lg);
    overflow: hidden;
    margin-bottom: 1.5rem;
}

#remote-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    background: #000;
}

#local-video {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    width: 120px;
    height: 90px;
    border-radius: var(--radius-md);
    object-fit: cover;
    border: 2px solid var(--primary-color);
    background: #000;
}

.call-info {
    margin-bottom: 1.5rem;
}

#call-status {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

#call-with {
    font-size: 1rem;
    color: var(--text-secondary);
}

.call-controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--bg-darker);
    border-top: 1px solid var(--border-color);
}

.call-control-btn {
    width: 3.5rem;
    height: 3.5rem;
    border-radius: 50%;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: var(--transition);
}

.call-control-btn:not(.end-call-btn):not(.reject-call-btn) {
    background: var(--bg-input);
    color: var(--text-primary);
}

.call-control-btn:not(.end-call-btn):not(.reject-call-btn):hover {
    background: var(--bg-hover);
    transform: scale(1.05);
}

.end-call-btn, .reject-call-btn {
    background: var(--danger-color);
    color: white;
}

.end-call-btn:hover, .reject-call-btn:hover {
    background: #dc2626;
    transform: scale(1.05);
}

.call-control-btn i {
    font-size: 1.25rem;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞ */
@keyframes pulse-ring {
    0% {
        transform: scale(0.8);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.2);
        opacity: 0.4;
    }
    100% {
        transform: scale(0.8);
        opacity: 0.8;
    }
}

.call-ringing .call-control-btn:first-child {
    animation: pulse-ring 2s infinite;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
@media (max-width: 768px) {
    .call-modal-content {
        width: 95%;
        max-width: none;
    }

    .video-container {
        height: 250px;
    }

    #local-video {
        width: 100px;
        height: 75px;
    }

    .call-controls {
        gap: 0.75rem;
        padding: 1rem;
    }

    .call-control-btn {
        width: 3rem;
        height: 3rem;
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .video-container {
        height: 200px;
    }

    #local-video {
        width: 80px;
        height: 60px;
        bottom: 0.5rem;
        right: 0.5rem;
    }

    .call-controls {
        gap: 0.5rem;
    }

    .call-control-btn {
        width: 2.75rem;
        height: 2.75rem;
    }
}/* –°–±—Ä–æ—Å –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
    --primary-color: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;

    --secondary-color: #8b5cf6;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --info-color: #3b82f6;

    --bg-dark: #0f172a;
    --bg-darker: #0a0f1f;
    --bg-card: #1e293b;
    --bg-input: #334155;
    --bg-hover: #2d3748;

    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;

    --border-color: #475569;
    --border-light: #64748b;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);

    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-full: 9999px;

    --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

body.light-theme {
    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    --primary-color: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;

    --secondary-color: #8b5cf6;
    --success-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --info-color: #3b82f6;

    --bg-dark: #f8fafc;
    --bg-darker: #f1f5f9;
    --bg-card: #ffffff;
    --bg-input: #f1f5f9;
    --bg-hover: #e2e8f0;

    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-muted: #94a3b8;

    --border-color: #e2e8f0;
    --border-light: #cbd5e1;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    min-height: 100vh;
    transition: var(--transition);
}

/* –°—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
.auth-page {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 1rem;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

.auth-container {
    width: 100%;
    max-width: 440px;
}

.auth-card {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    padding: 2.5rem;
    box-shadow: var(--shadow-lg);
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.auth-header {
    text-align: center;
    margin-bottom: 2rem;
}

.logo {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1.5rem;
}

.logo i {
    font-size: 2rem;
}

.auth-header h1 {
    font-size: 1.75rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.auth-header p {
    color: var(--text-secondary);
    font-size: 0.9375rem;
}

.alert {
    padding: 1rem;
    border-radius: var(--radius-md);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.alert-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #fca5a5;
}

.alert-success {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
    color: #34d399;
}

.alert-info {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    color: #93c5fd;
}

.auth-form {
    margin-bottom: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
    font-weight: 500;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 0.875rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
    font-family: 'Inter', sans-serif;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    background: var(--bg-card);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.form-group input[type="password"] {
    letter-spacing: 0.1em;
}

.input-with-prefix {
    display: flex;
    align-items: center;
}

.input-with-prefix .prefix {
    background: var(--bg-input);
    padding: 0.875rem 1rem;
    border: 2px solid var(--border-color);
    border-right: none;
    border-radius: var(--radius-md) 0 0 var(--radius-md);
    color: var(--text-secondary);
    font-size: 0.9375rem;
    font-weight: 500;
}

.input-with-prefix input {
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
}

.form-hint {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.375rem;
}

.btn {
    padding: 0.875rem 1.5rem;
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.9375rem;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-family: 'Inter', sans-serif;
}

.btn-block {
    width: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    position: relative;
    overflow: hidden;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn-primary::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
}

.btn-primary:hover::after {
    left: 100%;
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--border-color);
    color: var(--text-primary);
}

.btn-outline:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    background: rgba(99, 102, 241, 0.05);
}

.btn-danger {
    background: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background: #dc2626;
    transform: translateY(-2px);
}

.btn-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: var(--radius-full);
    border: none;
    background: var(--bg-input);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.btn-icon:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.auth-footer {
    text-align: center;
    padding-top: 1.5rem;
    margin-top: 1.5rem;
    border-top: 1px solid var(--border-color);
}

.auth-footer p {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
}

.link:hover {
    text-decoration: underline;
}

.security-info,
.demo-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    margin-top: 1.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.security-info i {
    color: var(--success-color);
}

.demo-info i {
    color: var(--info-color);
}

/* –ß–∞—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
.chat-app {
    display: flex;
    height: 100vh;
    background: var(--bg-dark);
}

/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
.sidebar {
    width: 380px;
    background: var(--bg-card);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    transition: var(--transition);
}

.sidebar-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.user-profile {
    flex: 1;
}

.user-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    text-decoration: none;
    color: inherit;
    transition: var(--transition);
}

.user-link:hover {
    opacity: 0.9;
}

.user-avatar {
    width: 3rem;
    height: 3rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 1.25rem;
    position: relative;
    overflow: hidden;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-info h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.user-status {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--text-secondary);
}

.user-status.online {
    color: var(--success-color);
}

.user-status i {
    font-size: 0.5rem;
}

.sidebar-actions {
    display: flex;
    gap: 0.5rem;
}

.search-container {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    position: relative;
}

.search-box {
    position: relative;
    display: flex;
    align-items: center;
}

.search-box i {
    position: absolute;
    left: 1rem;
    color: var(--text-muted);
    font-size: 0.875rem;
}

.search-box input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 0.875rem;
    transition: var(--transition);
}

.search-box input:focus {
    outline: none;
    background: var(--bg-card);
    border-color: var(--primary-color);
}

.search-results {
    position: absolute;
    top: 100%;
    left: 1.5rem;
    right: 1.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    margin-top: 0.5rem;
    max-height: 320px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.no-results {
    padding: 2rem 1rem;
    text-align: center;
    color: var(--text-muted);
    font-size: 0.875rem;
}

.contacts-container {
    flex: 1;
    overflow-y: auto;
}

.contacts-header {
    padding: 1.25rem 1.5rem 0.75rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.contacts-header h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.badge {
    padding: 0.25rem 0.75rem;
    background: var(--primary-color);
    color: white;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 500;
}

.contacts-list {
    display: flex;
    flex-direction: column;
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: var(--transition);
    border-bottom: 1px solid var(--border-color);
    position: relative;
}

.contact-item:hover {
    background: var(--bg-hover);
}

.contact-item.active {
    background: var(--bg-input);
    border-left: 3px solid var(--primary-color);
}

.contact-avatar {
    width: 2.75rem;
    height: 2.75rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 1rem;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.contact-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.status-indicator {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 0.75rem;
    height: 0.75rem;
    border-radius: var(--radius-full);
    background: var(--text-muted);
    border: 2px solid var(--bg-card);
    transition: var(--transition);
}

.status-indicator.online {
    background: var(--success-color);
    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
}

.contact-info {
    flex: 1;
    min-width: 0;
}

.contact-name-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.25rem;
}

.contact-name-row h4 {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.message-time {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.contact-preview {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
.chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-dark);
}

.chat-header {
    padding: 1.5rem 2rem;
    background: var(--bg-card);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.chat-actions {
    display: flex;
    gap: 0.5rem;
}

.empty-chat {
    text-align: center;
    padding: 3rem 1rem;
}

.empty-icon {
    font-size: 4rem;
    color: var(--primary-color);
    opacity: 0.2;
    margin-bottom: 1.5rem;
}

.empty-chat h2 {
    font-size: 1.75rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

.empty-chat p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
    font-size: 1rem;
}

.empty-contacts {
    padding: 3rem 1rem;
    text-align: center;
    color: var(--text-secondary);
}

.empty-contacts .empty-icon {
    font-size: 3rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
    opacity: 0.5;
}

.messages-container {
    flex: 1;
    padding: 1.5rem 2rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: var(--bg-dark);
}

.message {
    display: flex;
    max-width: 65%;
    animation: messageAppear 0.3s ease;
}

@keyframes messageAppear {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message.incoming {
    align-self: flex-start;
}

.message.outgoing {
    align-self: flex-end;
    flex-direction: row-reverse;
}

.message-avatar {
    width: 2.25rem;
    height: 2.25rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 0.875rem;
    flex-shrink: 0;
    margin-top: auto;
}

.message.incoming .message-avatar {
    margin-right: 0.75rem;
}

.message.outgoing .message-avatar {
    margin-left: 0.75rem;
}

.message-content {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
}

.message-bubble {
    padding: 0.75rem 1rem;
    border-radius: var(--radius-lg);
    font-size: 0.9375rem;
    line-height: 1.4;
    word-break: break-word;
    position: relative;
    max-width: 100%;
}

.message.incoming .message-bubble {
    background: var(--bg-card);
    border-bottom-left-radius: var(--radius-sm);
    color: var(--text-primary);
    box-shadow: var(--shadow-sm);
}

.message.outgoing .message-bubble {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-bottom-right-radius: var(--radius-sm);
    color: white;
}

.message-text {
    word-wrap: break-word;
}

.message-media {
    margin: 0.5rem 0;
    border-radius: var(--radius-md);
    overflow: hidden;
}

.message-media img,
.message-media video {
    max-width: 300px;
    max-height: 300px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: transform 0.2s ease;
    display: block;
}

.message-media img:hover {
    transform: scale(1.02);
}

.message-media video {
    background: #000;
}

.media-caption {
    margin-top: 0.5rem;
    padding: 0.5rem 0;
    color: inherit;
    font-size: 0.9375rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.message.outgoing .media-caption {
    border-top-color: rgba(255, 255, 255, 0.2);
}

.message-time {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: right;
}

.message-input-container {
    padding: 1.5rem 2rem;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.typing-indicator {
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    animation: typingPulse 1.5s infinite;
}

@keyframes typingPulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

.message-input-wrapper {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    width: 100%;
}

.attachment-buttons {
    display: flex;
    gap: 0.5rem;
}

#message-form {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

#message-input {
    flex: 1;
    padding: 0.875rem 1.25rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
}

#message-input:focus {
    outline: none;
    background: var(--bg-card);
    border-color: var(--primary-color);
}

.btn-send {
    width: 3rem;
    height: 3rem;
    padding: 0;
    border-radius: var(--radius-full);
    font-size: 1.125rem;
}

/* –ü—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏–π */
.attachment-preview {
    margin-top: 0.5rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    border: 2px dashed var(--border-color);
    display: none;
}

.preview-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.preview-content {
    flex: 1;
    display: flex;
    gap: 1rem;
    align-items: center;
}

.preview-image img,
.preview-video video {
    max-width: 150px;
    max-height: 150px;
    border-radius: var(--radius-md);
    object-fit: cover;
}

.preview-video video {
    background: #000;
}

.preview-info {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.btn-remove-attachment {
    background: var(--danger-color);
    color: white;
}

.btn-remove-attachment:hover {
    background: #dc2626;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
.call-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.9);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.call-modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

.call-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
}

.call-modal-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

#call-timer {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-left: 0.5rem;
}

.call-modal-body {
    padding: 2rem 1.5rem;
    text-align: center;
}

.calling-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.calling-dots {
    display: flex;
    gap: 0.5rem;
}

.calling-dots .dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: var(--primary-color);
    animation: dotPulse 1.4s ease-in-out infinite;
}

.calling-dots .dot:nth-child(1) { animation-delay: -0.32s; }
.calling-dots .dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes dotPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

.incoming-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.caller-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.caller-avatar {
    width: 5rem;
    height: 5rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 600;
    color: white;
}

.caller-details {
    text-align: center;
}

.caller-details h4 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
}

.caller-details p {
    color: var(--text-secondary);
}

.video-container {
    position: relative;
    width: 100%;
    height: 300px;
    margin: 1rem 0;
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--bg-darker);
}

#local-video {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    width: 120px;
    height: 90px;
    border-radius: var(--radius-md);
    object-fit: cover;
    border: 2px solid var(--border-color);
    z-index: 1;
}

#remote-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.call-controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1rem;
}

.call-controls .btn-icon {
    width: 3.5rem;
    height: 3.5rem;
    font-size: 1.25rem;
}

.call-controls .btn-danger {
    background: var(--danger-color);
    color: white;
}

.call-controls .btn-danger:hover {
    background: #dc2626;
}

.active-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.active-call p {
    font-size: 1.125rem;
    color: var(--text-primary);
}

.call-modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: center;
    gap: 1rem;
}

/* –ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –º–µ–¥–∏–∞ */
.media-viewer {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.media-viewer-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
}

.media-viewer-content img,
.media-viewer-content video {
    max-width: 100%;
    max-height: 90vh;
    border-radius: var(--radius-lg);
}

.media-viewer-content video {
    background: #000;
}

.close-viewer {
    position: absolute;
    top: -3rem;
    right: 0;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 3rem;
    height: 3rem;
    border-radius: var(--radius-full);
    font-size: 1.5rem;
    cursor: pointer;
    transition: var(--transition);
}

.close-viewer:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è */
.profile-page {
    min-height: 100vh;
    background: var(--bg-dark);
    padding: 1rem;
}

.profile-nav {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.9375rem;
    font-weight: 500;
    transition: var(--transition);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-md);
}

.back-btn:hover {
    color: var(--primary-color);
    background: var(--bg-input);
}

.profile-nav h1 {
    font-size: 1.75rem;
    font-weight: 600;
    color: var(--text-primary);
}

.profile-content {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
}

.profile-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    transition: var(--transition);
}

.profile-card:hover {
    box-shadow: var(--shadow-md);
}

.avatar-section {
    text-align: center;
    margin-bottom: 1.5rem;
}

.avatar-preview {
    width: 8rem;
    height: 8rem;
    border-radius: var(--radius-full);
    margin: 0 auto 1rem;
    border: 4px solid var(--primary-color);
    overflow: hidden;
    position: relative;
}

.avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    font-weight: 600;
    color: white;
}

.avatar-actions {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 1rem;
}

.user-info {
    text-align: center;
    margin-bottom: 1.5rem;
}

.user-info h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.username {
    color: var(--text-secondary);
    font-size: 0.9375rem;
    margin-bottom: 1rem;
}

.description {
    color: var(--text-primary);
    font-size: 0.9375rem;
    line-height: 1.5;
    margin-bottom: 1.5rem;
}

.user-stats {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1.5rem;
}

.stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
}

.stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.stat-value {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã */
.theme-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

.theme-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition);
}

.theme-option:hover {
    border-color: var(--primary-light);
}

.theme-option.active {
    border-color: var(--primary-color);
    background: rgba(99, 102, 241, 0.05);
}

.theme-preview {
    width: 100%;
    height: 5rem;
    border-radius: var(--radius-md);
    overflow: hidden;
    position: relative;
}

.theme-preview.dark {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
}

.theme-preview.light {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.preview-header {
    height: 1.5rem;
    background: rgba(0, 0, 0, 0.1);
}

.preview-body {
    height: calc(100% - 1.5rem);
    padding: 0.5rem;
}

.theme-preview.dark .preview-body::before,
.theme-preview.light .preview-body::before {
    content: '';
    display: block;
    width: 60%;
    height: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-sm);
    margin-bottom: 0.25rem;
}

.theme-preview.light .preview-body::before {
    background: rgba(0, 0, 0, 0.1);
}

.theme-option span {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
}

/* –§–æ—Ä–º—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
.profile-card h3 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.profile-card h3 i {
    color: var(--primary-color);
}

#edit-profile-form,
#change-password-form,
#change-username-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.danger-zone {
    border-color: rgba(239, 68, 68, 0.3);
    background: rgba(239, 68, 68, 0.05);
}

.danger-zone h3 {
    color: var(--danger-color);
}

.danger-zone p {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
}

.danger-actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.notification {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: var(--shadow-lg);
    z-index: 9999;
    transform: translateX(120%);
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    border-left: 4px solid var(--primary-color);
    max-width: 400px;
}

.notification.show {
    transform: translateX(0);
}

.notification.success {
    border-left-color: var(--success-color);
}

.notification.error {
    border-left-color: var(--danger-color);
}

.notification.info {
    border-left-color: var(--info-color);
}

.notification i {
    font-size: 1.25rem;
}

.notification.success i {
    color: var(--success-color);
}

.notification.error i {
    color: var(--danger-color);
}

.notification.info i {
    color: var(--info-color);
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.notification-message {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.notification-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    font-size: 1rem;
    transition: var(--transition);
}

.notification-close:hover {
    color: var(--text-primary);
}

/* –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é */
.mobile-menu {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: space-around;
    padding: 0.75rem;
    z-index: 1000;
    display: none;
}

.mobile-menu-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.75rem;
    padding: 0.5rem;
    border-radius: var(--radius-md);
    transition: var(--transition);
}

.mobile-menu-item.active,
.mobile-menu-item:hover {
    color: var(--primary-color);
    background: var(--bg-input);
}

.mobile-menu-item i {
    font-size: 1.25rem;
}

/* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-input);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .profile-content {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .profile-left,
    .profile-right {
        width: 100%;
    }
}

@media (max-width: 768px) {
    .chat-app {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
    }

    .contacts-container {
        max-height: 300px;
    }

    .profile-content {
        padding: 0.5rem;
    }

    .profile-nav {
        padding: 0.5rem;
    }

    .notification {
        left: 1rem;
        right: 1rem;
        max-width: none;
    }

    .mobile-menu {
        display: flex;
    }

    .call-modal-content {
        width: 95%;
        margin: 1rem;
    }

    .video-container {
        height: 200px;
    }

    #local-video {
        width: 80px;
        height: 60px;
    }
}

@media (max-width: 480px) {
    .auth-card {
        padding: 1.5rem;
    }

    .logo {
        font-size: 1.5rem;
    }

    .logo i {
        font-size: 1.75rem;
    }

    .auth-header h1 {
        font-size: 1.5rem;
    }

    .theme-selector {
        grid-template-columns: 1fr;
    }

    .message {
        max-width: 85%;
    }

    .call-controls {
        gap: 0.5rem;
    }

    .call-controls .btn-icon {
        width: 3rem;
        height: 3rem;
    }
}

/* –ó–∞–≥—Ä—É–∑—á–∏–∫ */
.loader {
    display: inline-block;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--border-color);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(4px);
}

.loading-spinner {
    width: 3rem;
    height: 3rem;
    border: 3px solid var(--border-color);
    border-radius: 50%;
    border-top-color: var(--primary-color);
    animation: spin 1s linear infinite;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.pulse {
    animation: pulse 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.bounce {
    animation: bounce 2s infinite;
}
/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
.btn-send:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.fa-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–µ–¥–∏–∞ */
.message-media {
    position: relative;
    max-width: 300px;
    margin: 0.5rem 0;
}

.message-media img {
    max-width: 100%;
    max-height: 300px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: transform 0.2s ease;
    display: block;
}

.message-media video {
    max-width: 100%;
    max-height: 300px;
    border-radius: var(--radius-md);
    background: #000;
    cursor: pointer;
}

.message-media img:hover {
    transform: scale(1.02);
}

.media-caption {
    margin-top: 0.5rem;
    padding: 0.5rem 0;
    color: inherit;
    font-size: 0.9375rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.message.outgoing .media-caption {
    border-top-color: rgba(255, 255, 255, 0.2);
}

/* –ü—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏—è */
.attachment-preview {
    margin-top: 0.5rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    border: 2px dashed var(--border-color);
    display: none;
}

.preview-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
}

.preview-content {
    flex: 1;
    display: flex;
    gap: 1rem;
    align-items: center;
}

.preview-image img,
.preview-video video {
    max-width: 150px;
    max-height: 150px;
    border-radius: var(--radius-md);
    object-fit: cover;
}

.preview-video video {
    background: #000;
}

.preview-info {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.btn-remove-attachment {
    background: var(--danger-color);
    color: white;
}

.btn-remove-attachment:hover {
    background: #dc2626;
}

/* –°–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ */
.upload-progress {
    width: 100%;
    height: 4px;
    background: var(--border-color);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.upload-progress-bar {
    height: 100%;
    background: var(--primary-color);
    transition: width 0.3s ease;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message {
    animation: fadeIn 0.3s ease;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–µ–¥–∏–∞ */
@media (max-width: 768px) {
    .message-media {
        max-width: 250px;
    }

    .message-media img,
    .message-media video {
        max-height: 250px;
    }
}

@media (max-width: 480px) {
    .message-media {
        max-width: 200px;
    }

    .message-media img,
    .message-media video {
        max-height: 200px;
    }

    .preview-image img,
    .preview-video video {
        max-width: 100px;
        max-height: 100px;
    }
}
/* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
.context-menu {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    min-width: 180px;
    z-index: 10000;
    overflow: hidden;
}

.context-menu-content {
    padding: 0.25rem 0;
}

.context-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.context-menu-item:hover {
    background: var(--bg-input);
}

.context-menu-item i {
    width: 1rem;
    text-align: center;
    color: var(--text-secondary);
}

/* –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –≤ –ø–æ–∏—Å–∫–µ */
.search-result {
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
}

.search-result:hover {
    background: var(--bg-hover);
}

.user-status-badge {
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius-full);
    font-weight: 500;
}

.user-status-badge.online {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-color);
}

.user-status-badge.offline {
    background: rgba(148, 163, 184, 0.2);
    color: var(--text-secondary);
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.message-bubble {
    position: relative;
}

.message-bubble:hover::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.03);
    pointer-events: none;
    border-radius: var(--radius-lg);
}

.message.outgoing .message-bubble:hover::after {
    background: rgba(255, 255, 255, 0.05);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
@keyframes messageAppear {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message {
    animation: messageAppear 0.3s ease;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
.messages-container::-webkit-scrollbar {
    width: 8px;
}

.messages-container::-webkit-scrollbar-track {
    background: transparent;
}

.messages-container::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
}

.messages-container::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é */
@media (max-width: 768px) {
    .context-menu {
        min-width: 160px;
        font-size: 0.8125rem;
    }

    .context-menu-item {
        padding: 0.625rem 0.875rem;
    }
}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.btn-icon:active {
    transform: scale(0.95);
}

.message-avatar {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.message-avatar:hover {
    transform: scale(1.05);
}

.contact-item.active .contact-avatar {
    border: 2px solid var(--primary-color);
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
.new-message-indicator {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 12px;
    height: 12px;
    background: var(--danger-color);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.7;
        transform: scale(1.1);
    }
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ */
.search-box {
    position: relative;
}

.search-box:focus-within {
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.search-results {
    max-height: 400px;
    overflow-y: auto;
}

.search-results::-webkit-scrollbar {
    width: 6px;
}

.search-results::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —á–∞—Ç–∞ */
.chat-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    color: var(--text-secondary);
}

.chat-loading .loader {
    width: 2rem;
    height: 2rem;
    border-width: 3px;
    margin-bottom: 1rem;
}
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
.users-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    max-height: 500px;
    overflow-y: auto;
}

.user-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    transition: var(--transition);
}

.user-item:hover {
    border-color: var(--primary-color);
    background: var(--bg-hover);
}

.user-item .user-avatar {
    width: 3rem;
    height: 3rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.user-item .user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-info {
    flex: 1;
    min-width: 0;
}

.user-name-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.25rem;
}

.user-name-row h4 {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--text-primary);
}

.user-username {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.user-description {
    font-size: 0.8125rem;
    color: var(--text-primary);
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.user-actions {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
}

.modal-content {
    max-width: 600px;
    width: 90%;
}
/* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
.context-menu {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    min-width: 180px;
    z-index: 10000;
    overflow: hidden;
    animation: fadeIn 0.15s ease;
}

.context-menu-content {
    padding: 0.25rem 0;
}

.context-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-primary);
    font-size: 0.875rem;
    user-select: none;
}

.context-menu-item:hover {
    background: var(--bg-input);
}

.context-menu-item i {
    width: 1rem;
    text-align: center;
    color: var(--text-secondary);
}

/* –ü–æ–∏—Å–∫ */
.search-result {
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: var(--transition);
}

.search-result:hover {
    background: var(--bg-hover);
}

.no-results {
    padding: 1.5rem;
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.user-status-badge {
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius-full);
    font-weight: 500;
    white-space: nowrap;
}

.user-status-badge.online {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success-color);
}

.user-status-badge.offline {
    background: rgba(148, 163, 184, 0.2);
    color: var(--text-secondary);
}

/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.2s ease;
}

.modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: var(--shadow-lg);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.modal-body {
    padding: 1.5rem;
    flex: 1;
    overflow-y: auto;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

/* Forward dialog specific */
.forward-message-preview {
    background: var(--bg-input);
    border-radius: var(--radius-md);
    padding: 1rem;
    margin-bottom: 1rem;
}

.message-preview {
    font-size: 0.875rem;
}

.message-preview strong {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.message-preview p {
    color: var(--text-secondary);
    line-height: 1.4;
}

.search-recipient {
    position: relative;
}

.search-recipient input {
    width: 100%;
    padding: 0.875rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
}

.search-recipient input:focus {
    outline: none;
    border-color: var(--primary-color);
    background: var(--bg-card);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.message {
    animation: fadeIn 0.3s ease;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
.fa-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

/* –ü—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞ */
.reply-preview {
    background: var(--bg-input);
    border-radius: var(--radius-md);
    margin: 0 2rem 0.5rem;
    border-left: 3px solid var(--primary-color);
    position: relative;
}

.reply-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

.reply-preview-header span {
    font-size: 0.75rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.reply-preview-content {
    padding: 0.75rem 1rem;
}

.reply-preview-content strong {
    display: block;
    margin-bottom: 0.25rem;
    color: var(--primary-color);
    font-size: 0.875rem;
}

.reply-preview-content p {
    font-size: 0.875rem;
    color: var(--text-primary);
    line-height: 1.4;
    margin: 0;
}

/* Forward label in messages */
.forward-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.forward-label i {
    font-size: 0.625rem;
}

/* Edit label in messages */
.edit-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.edit-label i {
    font-size: 0.625rem;
}

/* –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
.edit-message-container {
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    animation: slideInUp 0.3s ease;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.edit-message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.edit-message-header span {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

#edit-message-form {
    display: flex;
    align-items: center;
    gap: 1rem;
}

#edit-message-input {
    flex: 1;
    padding: 0.875rem 1.25rem;
    background: var(--bg-input);
    border: 2px solid var(--primary-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 0.9375rem;
    transition: var(--transition);
}

#edit-message-input:focus {
    outline: none;
    background: var(--bg-card);
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
.search-results::-webkit-scrollbar,
.messages-container::-webkit-scrollbar,
.modal-body::-webkit-scrollbar {
    width: 6px;
}

.search-results::-webkit-scrollbar-track,
.messages-container::-webkit-scrollbar-track,
.modal-body::-webkit-scrollbar-track {
    background: transparent;
}

.search-results::-webkit-scrollbar-thumb,
.messages-container::-webkit-scrollbar-thumb,
.modal-body::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 3px;
}

.search-results::-webkit-scrollbar-thumb:hover,
.messages-container::-webkit-scrollbar-thumb:hover,
.modal-body::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .context-menu {
        min-width: 160px;
        font-size: 0.8125rem;
    }

    .context-menu-item {
        padding: 0.625rem 0.875rem;
    }

    .reply-preview {
        margin: 0 1rem 0.5rem;
    }

    .modal-content {
        width: 95%;
        margin: 1rem;
    }
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
.call-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.95);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.call-modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

.call-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
}

.call-modal-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

#call-timer {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-left: 0.5rem;
}

.call-modal-body {
    padding: 2rem 1.5rem;
    text-align: center;
}

.calling-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.calling-dots {
    display: flex;
    gap: 0.5rem;
}

.calling-dots .dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: var(--primary-color);
    animation: dotPulse 1.4s ease-in-out infinite;
}

.calling-dots .dot:nth-child(1) { animation-delay: -0.32s; }
.calling-dots .dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes dotPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
}

.incoming-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}

.caller-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.caller-avatar {
    width: 5rem;
    height: 5rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 600;
    color: white;
}

.caller-details {
    text-align: center;
}

.caller-details h4 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
}

.caller-details p {
    color: var(--text-secondary);
}

.active-call {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.active-call p {
    font-size: 1.125rem;
    color: var(--text-primary);
}

.video-placeholder, .audio-placeholder {
    width: 200px;
    height: 200px;
    border-radius: var(--radius-xl);
    background: var(--bg-input);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin: 1rem auto;
}

.video-placeholder i, .audio-placeholder i {
    font-size: 3rem;
    color: var(--primary-color);
}

.video-placeholder p, .audio-placeholder p {
    color: var(--text-secondary);
}

.call-modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: center;
    gap: 1rem;
}

@media (max-width: 768px) {
    .call-modal-content {
        width: 95%;
        margin: 1rem;
    }
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
.call-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.95);
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.call-modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.call-header {
    padding: 1.5rem;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
}

.call-header h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.call-timer {
    font-size: 1.25rem;
    color: var(--primary-color);
    font-weight: 500;
    font-family: monospace;
}

.call-body {
    padding: 2rem;
    text-align: center;
}

.video-container {
    position: relative;
    width: 100%;
    height: 300px;
    background: var(--bg-darker);
    border-radius: var(--radius-lg);
    overflow: hidden;
    margin-bottom: 1.5rem;
}

#remote-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    background: #000;
}

#local-video {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    width: 120px;
    height: 90px;
    border-radius: var(--radius-md);
    object-fit: cover;
    border: 2px solid var(--primary-color);
    background: #000;
}

.call-info {
    margin-bottom: 1.5rem;
}

#call-status {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

#call-with {
    font-size: 1rem;
    color: var(--text-secondary);
}

.call-controls {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--bg-darker);
    border-top: 1px solid var(--border-color);
}

.call-control-btn {
    width: 3.5rem;
    height: 3.5rem;
    border-radius: 50%;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: var(--transition);
}

.call-control-btn:not(.end-call-btn):not(.reject-call-btn) {
    background: var(--bg-input);
    color: var(--text-primary);
}

.call-control-btn:not(.end-call-btn):not(.reject-call-btn):hover {
    background: var(--bg-hover);
    transform: scale(1.05);
}

.end-call-btn, .reject-call-btn {
    background: var(--danger-color);
    color: white;
}

.end-call-btn:hover, .reject-call-btn:hover {
    background: #dc2626;
    transform: scale(1.05);
}

.call-control-btn i {
    font-size: 1.25rem;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞ */
@keyframes pulse-ring {
    0% {
        transform: scale(0.8);
        opacity: 0.8;
    }
    50% {
        transform: scale(1.2);
        opacity: 0.4;
    }
    100% {
        transform: scale(0.8);
        opacity: 0.8;
    }
}

.call-ringing .call-control-btn:first-child {
    animation: pulse-ring 2s infinite;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
@media (max-width: 768px) {
    .call-modal-content {
        width: 95%;
        max-width: none;
    }

    .video-container {
        height: 250px;
    }

    #local-video {
        width: 100px;
        height: 75px;
    }

    .call-controls {
        gap: 0.75rem;
        padding: 1rem;
    }

    .call-control-btn {
        width: 3rem;
        height: 3rem;
        font-size: 1rem;
    }
}

@media (max-width: 480px) {
    .video-container {
        height: 200px;
    }

    #local-video {
        width: 80px;
        height: 60px;
        bottom: 0.5rem;
        right: 0.5rem;
    }

    .call-controls {
        gap: 0.5rem;
    }

    .call-control-btn {
        width: 2.75rem;
        height: 2.75rem;
    }
}

> telegram-like-messenge
templates
base.html

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kildear Messenger</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/5968/5968771.png">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    {% block head %}{% endblock %}
</head>
<body class="dark-theme">
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notifications-container"></div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script>
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
            }
        }

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–º—É –∏–∑ localStorage –∏–ª–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const savedTheme = localStorage.getItem('theme') || 'dark';
            applyTheme(savedTheme);
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>

<> blocked.html

{% extends "base.html" %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-ban"></i>
                    <span>Kildear</span>
                </div>
                <h1>–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h1>
                <p>–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</p>
            </div>

            <div class="alert alert-error">
                <i class="fas fa-exclamation-triangle"></i>
                <span>–î–æ—Å—Ç—É–ø –∫ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</span>
            </div>

            <div class="blocked-info">
                <p>–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:</p>
                <ul>
                    <li>–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</li>
                    <li>–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</li>
                    <li>–ñ–∞–ª–æ–±—ã –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                </ul>

                <p class="contact-admin">
                    –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ –æ—à–∏–±–∫–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º:
                    <br>
                    <strong>admin@kildear.com</strong>
                </p>
            </div>

            <div class="auth-footer">
                <a href="{{ url_for('logout') }}" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.blocked-info {
    padding: 1.5rem;
    background: var(--bg-input);
    border-radius: var(--radius-md);
    margin-bottom: 1.5rem;
}

.blocked-info p {
    margin-bottom: 1rem;
    color: var(--text-secondary);
}

.blocked-info ul {
    margin-left: 1.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
}

.blocked-info li {
    margin-bottom: 0.5rem;
}

.contact-admin {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
    font-size: 0.875rem;
}
</style>
{% endblock %}

chat.html

{% extends "base.html" %}

{% block content %}
<div class="chat-app">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="sidebar">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="sidebar-header">
            <div class="user-profile">
                <a href="{{ url_for('profile') }}" class="user-link">
                    <div class="user-avatar" style="background: {{ current_user.avatar_color }};">
                        {% if current_user.avatar %}
                        <img src="{{ current_user.avatar }}" alt="{{ current_user.name }}">
                        {% else %}
                        {{ current_user.name[0]|upper }}
                        {% endif %}
                    </div>
                    <div class="user-info">
                        <h3>{{ current_user.name }}</h3>
                        <p class="user-status online">
                            <i class="fas fa-circle"></i> –æ–Ω–ª–∞–π–Ω
                        </p>
                    </div>
                </a>
            </div>
            <div class="sidebar-actions">
                <button class="btn-icon" id="search-toggle">
                    <i class="fas fa-search"></i>
                </button>
                <button class="btn-icon" id="pinned-messages-btn" title="–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è">
                    <i class="fas fa-thumbtack"></i>
                </button>
                <button class="btn-icon" id="blocked-users-btn" title="–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏">
                    <i class="fas fa-ban"></i>
                </button>
                <a href="{{ url_for('profile') }}" class="btn-icon" title="–ü—Ä–æ—Ñ–∏–ª—å">
                    <i class="fas fa-user"></i>
                </a>
                <a href="{{ url_for('logout') }}" class="btn-icon" title="–í—ã–π—Ç–∏">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>

        <!-- –ü–æ–∏—Å–∫ -->
        <div class="search-container" id="search-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
            </div>
            <div id="search-results" class="search-results"></div>
        </div>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div class="contacts-container">
            <div class="contacts-header">
                <h3>–ß–∞—Ç—ã</h3>
                <span class="badge" id="online-count">0</span>
            </div>

            <div class="contacts-list" id="contacts-list">
                <div class="empty-contacts" id="empty-contacts">
                    <div class="empty-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <p>–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π —á–∞—Ç —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
    <div class="chat-area">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
        <div class="chat-header" id="chat-header">
            <div class="empty-chat">
                <div class="empty-icon">
                    <i class="fas fa-comment-dots"></i>
                </div>
                <h2>Kildear Messenger</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</p>
                <button class="btn btn-outline" id="start-new-chat">
                    <i class="fas fa-search"></i> –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </button>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="messages-container" id="messages-container">
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <!-- –í–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="message-input-container" id="message-input-container" style="display: none;">
            <div class="typing-indicator" id="typing-indicator" style="display: none;">
                <span id="typing-text"></span>
            </div>
            <div class="message-input-wrapper">
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π -->
                <div class="attachment-buttons">
                    <button type="button" class="btn-icon" id="attach-photo" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ">
                        <i class="fas fa-image"></i>
                        <input type="file" id="photo-input" accept="image/*" style="display: none;">
                    </button>
                    <button type="button" class="btn-icon" id="attach-video" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ">
                        <i class="fas fa-video"></i>
                        <input type="file" id="video-input" accept="video/*" style="display: none;">
                    </button>
                </div>

                <div id="message-form">
                    <input type="text" id="message-input"
                           placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                           autocomplete="off"
                           maxlength="2000">
                    <button type="button" class="btn btn-primary btn-send" id="send-message-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- –ü—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏–π -->
            <div class="attachment-preview" id="attachment-preview" style="display: none;">
                <div class="preview-item">
                    <div class="preview-content">
                        <div class="preview-image" id="preview-image"></div>
                        <div class="preview-video" id="preview-video"></div>
                    </div>
                    <button type="button" class="btn-icon btn-remove-attachment" id="remove-attachment">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="preview-info" id="preview-info"></div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–≤–æ–Ω–∫–∞ -->
    <div id="call-modal" class="call-modal">
        <div class="call-modal-content">
            <div class="call-header">
                <h3 id="call-title">–ó–≤–æ–Ω–æ–∫</h3>
                <div class="call-timer" id="call-timer">00:00</div>
            </div>
            <div class="call-body">
                <div class="video-container">
                    <video id="remote-video" autoplay playsinline></video>
                    <video id="local-video" autoplay playsinline muted></video>
                </div>
                <div class="call-info">
                    <div id="call-status">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...</div>
                    <div id="call-with">–° –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</div>
                </div>
            </div>
            <div class="call-controls">
                <button class="call-control-btn" id="mute-audio-btn" title="–û—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="call-control-btn" id="mute-video-btn" title="–û—Ç–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ">
                    <i class="fas fa-video"></i>
                </button>
                <button class="call-control-btn end-call-btn" id="end-call-btn" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-phone-slash"></i>
                </button>
                <button class="call-control-btn" id="accept-call-btn" title="–ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫" style="display: none;">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="call-control-btn reject-call-btn" id="reject-call-btn" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫" style="display: none;">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è -->
<input type="hidden" id="current-user" value="{{ current_user.username }}">
<input type="hidden" id="current-user-name" value="{{ current_user.name }}">
<input type="hidden" id="current-user-color" value="{{ current_user.avatar_color }}">
<input type="hidden" id="is-admin" value="{{ is_admin }}">
<input type="hidden" id="current-recipient">
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}

contacts.html

{% extends "base.html" %}

{% block content %}
<div class="contacts-page">
    <div class="page-header">
        <h1><i class="fas fa-users"></i> –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—ã—Ö –¥—Ä—É–∑–µ–π –¥–ª—è –æ–±—â–µ–Ω–∏—è</p>
    </div>

    <div class="search-box-container">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="global-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ —é–∑–µ—Ä–Ω–µ–π–º—É...">
        </div>
    </div>

    <div class="users-grid" id="users-grid">
        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('global-search');
    const usersGrid = document.getElementById('users-grid');

    function loadUsers(query = '') {
        fetch(`/search_users?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(users => {
                displayUsers(users);
            })
            .catch(error => {
                console.error('Error loading users:', error);
            });
    }

    function displayUsers(users) {
        usersGrid.innerHTML = '';

        if (users.length === 0) {
            usersGrid.innerHTML = '<div class="no-users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            return;
        }

        users.forEach(user => {
            const userCard = document.createElement('div');
            userCard.className = 'user-card';
            userCard.innerHTML = `
                <div class="user-avatar" style="background: ${user.avatar_color}">
                    ${user.avatar ? `<img src="${user.avatar}" alt="${user.name}">` : user.name[0].toUpperCase()}
                </div>
                <div class="user-info">
                    <h3>${user.name}</h3>
                    <p class="username">@${user.username}</p>
                    ${user.description ? `<p class="description">${user.description}</p>` : ''}
                </div>
                <button class="btn btn-outline btn-sm start-chat" data-username="${user.username}">
                    <i class="fas fa-comment"></i> –ß–∞—Ç
                </button>
            `;
            usersGrid.appendChild(userCard);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —á–∞—Ç–∞
        document.querySelectorAll('.start-chat').forEach(button => {
            button.addEventListener('click', function() {
                const username = this.dataset.username;
                window.location.href = `/chat?user=${username}`;
            });
        });
    }

    // –ü–æ–∏—Å–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    let searchTimeout;
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            loadUsers(this.value);
        }, 300);
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    loadUsers();
});
</script>

<style>
.contacts-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.page-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.page-header p {
    color: var(--text-secondary);
}

.search-box-container {
    max-width: 600px;
    margin: 0 auto 3rem;
}

.search-box {
    position: relative;
}

.search-box i {
    position: absolute;
    left: 1.5rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
}

.search-box input {
    width: 100%;
    padding: 1rem 1.5rem 1rem 3.5rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-full);
    color: var(--text-primary);
    font-size: 1rem;
    transition: var(--transition);
}

.search-box input:focus {
    outline: none;
    border-color: var(--primary-color);
    background: var(--bg-card);
}

.users-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.user-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    border: 1px solid var(--border-color);
    transition: var(--transition);
}

.user-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-color);
}

.user-card .user-avatar {
    width: 4rem;
    height: 4rem;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 600;
    color: white;
    flex-shrink: 0;
    overflow: hidden;
}

.user-card .user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.user-card .user-info {
    flex: 1;
}

.user-card h3 {
    font-size: 1.125rem;
    margin-bottom: 0.25rem;
}

.user-card .username {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
}

.user-card .description {
    font-size: 0.875rem;
    color: var(--text-primary);
    line-height: 1.4;
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.no-users {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
    font-size: 1.125rem;
}

@media (max-width: 768px) {
    .contacts-page {
        padding: 1rem;
    }

    .users-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

login.html

{% extends "base.html" %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-comment-dots"></i>
                    <span>Kildear</span>
                </div>
                <h1>–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</h1>
                <p>–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º –≤ Kildear Messenger</p>
            </div>

            {% if error %}
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                {{ error }}
            </div>
            {% endif %}

            <form method="POST" class="auth-form">
                <div class="form-group">
                    <label for="username">
                        <i class="fas fa-at"></i> –Æ–∑–µ—Ä–Ω–µ–π–º *
                    </label>
                    <input type="text" id="username" name="username" required
                           placeholder="username" value="{{ request.form.username or '' }}">
                </div>

                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i> –ü–∞—Ä–æ–ª—å *
                    </label>
                    <input type="password" id="password" name="password" required>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                </button>
            </form>

            <div class="auth-footer">
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="{{ url_for('register') }}" class="link">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            </div>

            <div class="security-info">
                <i class="fas fa-shield-alt"></i>
                <span>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã. –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ.</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<>profile.html

{% extends "base.html" %}

{% block content %}
<div class="profile-page">
    <nav class="profile-nav">
        <a href="{{ url_for('chat') }}" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            <span>–ù–∞–∑–∞–¥ –∫ —á–∞—Ç–∞–º</span>
        </a>
        <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
    </nav>

    <div class="profile-content">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="profile-left">
            <div class="profile-card avatar-section">
                <div class="avatar-preview" id="avatar-preview">
                    {% if user.avatar %}
                    <img src="{{ user.avatar }}" alt="{{ user.name }}">
                    {% else %}
                    <div class="avatar-placeholder" style="background: {{ user.avatar_color }};">
                        {{ user.name[0]|upper }}
                    </div>
                    {% endif %}
                </div>

                <div class="user-info">
                    <h2>{{ user.name }}</h2>
                    <div class="username">@{{ user.username }}</div>
                    {% if user.description %}
                    <div class="description">{{ user.description }}</div>
                    {% endif %}
                </div>

                <div class="user-stats">
                    <div class="stat">
                        <span class="stat-label">–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω</span>
                        <span class="stat-value" id="created-date">{{ user.created_at[:10] }}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</span>
                        <span class="stat-value">{{ user.theme }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="profile-right">
            <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="profile-card">
                <h3><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <form id="edit-profile-form">
                    <div class="form-group">
                        <label for="edit-name">–ò–º—è</label>
                        <input type="text" id="edit-name" value="{{ user.name }}">
                    </div>

                    <div class="form-group">
                        <label for="edit-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="edit-description">{{ user.description or '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                        <div class="theme-selector">
                            <div class="theme-option {{ 'active' if user.theme == 'dark' }}" data-theme="dark">
                                <div class="theme-preview dark"></div>
                                <span>–¢–µ–º–Ω–∞—è</span>
                            </div>
                            <div class="theme-option {{ 'active' if user.theme == 'light' }}" data-theme="light">
                                <div class="theme-preview light"></div>
                                <span>–°–≤–µ—Ç–ª–∞—è</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ê–≤–∞—Ç–∞—Ä</label>
                        <div class="avatar-actions">
                            <button type="button" class="btn btn-outline" id="change-avatar">
                                <i class="fas fa-image"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                            </button>
                            <input type="file" id="avatar-input" accept="image/*" style="display: none;">
                            <button type="button" class="btn btn-outline" id="remove-avatar">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </form>
            </div>

            <!-- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è -->
            <div class="profile-card">
                <h3><i class="fas fa-lock"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h3>
                <form id="change-password-form">
                    <div class="form-group">
                        <label for="current-password">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="current-password">
                    </div>

                    <div class="form-group">
                        <label for="new-password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new-password">
                    </div>

                    <div class="form-group">
                        <label for="confirm-new-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="confirm-new-password">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-key"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                    </button>
                </form>
            </div>

            <!-- –°–º–µ–Ω–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞ -->
            <div class="profile-card">
                <h3><i class="fas fa-at"></i> –°–º–µ–Ω–∏—Ç—å —é–∑–µ—Ä–Ω–µ–π–º</h3>
                <form id="change-username-form">
                    <div class="form-group">
                        <label for="new-username">–ù–æ–≤—ã–π —é–∑–µ—Ä–Ω–µ–π–º</label>
                        <input type="text" id="new-username" value="{{ user.username }}">
                    </div>

                    <div class="form-group">
                        <label for="password-for-username">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="password-for-username">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> –°–º–µ–Ω–∏—Ç—å —é–∑–µ—Ä–Ω–µ–π–º
                    </button>
                </form>
            </div>

            <!-- –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ -->
            <div class="profile-card danger-zone">
                <h3><i class="fas fa-exclamation-triangle"></i> –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h3>
                <p>–≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã.</p>

                <div class="danger-actions">
                    <button class="btn btn-danger btn-block" id="delete-account">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='profile.js') }}"></script>
{% endblock %}{% extends "base.html" %}

{% block content %}
<div class="profile-page">
    <nav class="profile-nav">
        <a href="{{ url_for('chat') }}" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            <span>–ù–∞–∑–∞–¥ –∫ —á–∞—Ç–∞–º</span>
        </a>
        <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
    </nav>

    <div class="profile-content">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="profile-left">
            <div class="profile-card avatar-section">
                <div class="avatar-preview" id="avatar-preview">
                    {% if user.avatar %}
                    <img src="{{ user.avatar }}" alt="{{ user.name }}">
                    {% else %}
                    <div class="avatar-placeholder" style="background: {{ user.avatar_color }};">
                        {{ user.name[0]|upper }}
                    </div>
                    {% endif %}
                </div>

                <div class="user-info">
                    <h2>{{ user.name }}</h2>
                    <div class="username">@{{ user.username }}</div>
                    {% if user.description %}
                    <div class="description">{{ user.description }}</div>
                    {% endif %}
                </div>

                <div class="user-stats">
                    <div class="stat">
                        <span class="stat-label">–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω</span>
                        <span class="stat-value" id="created-date">{{ user.created_at[:10] }}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</span>
                        <span class="stat-value">{{ user.theme }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="profile-right">
            <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="profile-card">
                <h3><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <form id="edit-profile-form">
                    <div class="form-group">
                        <label for="edit-name">–ò–º—è</label>
                        <input type="text" id="edit-name" value="{{ user.name }}">
                    </div>

                    <div class="form-group">
                        <label for="edit-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="edit-description">{{ user.description or '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                        <div class="theme-selector">
                            <div class="theme-option {{ 'active' if user.theme == 'dark' }}" data-theme="dark">
                                <div class="theme-preview dark"></div>
                                <span>–¢–µ–º–Ω–∞—è</span>
                            </div>
                            <div class="theme-option {{ 'active' if user.theme == 'light' }}" data-theme="light">
                                <div class="theme-preview light"></div>
                                <span>–°–≤–µ—Ç–ª–∞—è</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>–ê–≤–∞—Ç–∞—Ä</label>
                        <div class="avatar-actions">
                            <button type="button" class="btn btn-outline" id="change-avatar">
                                <i class="fas fa-image"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                            </button>
                            <input type="file" id="avatar-input" accept="image/*" style="display: none;">
                            <button type="button" class="btn btn-outline" id="remove-avatar">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                </form>
            </div>

            <!-- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è -->
            <div class="profile-card">
                <h3><i class="fas fa-lock"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h3>
                <form id="change-password-form">
                    <div class="form-group">
                        <label for="current-password">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="current-password">
                    </div>

                    <div class="form-group">
                        <label for="new-password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="new-password">
                    </div>

                    <div class="form-group">
                        <label for="confirm-new-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="confirm-new-password">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-key"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                    </button>
                </form>
            </div>

            <!-- –°–º–µ–Ω–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞ -->
            <div class="profile-card">
                <h3><i class="fas fa-at"></i> –°–º–µ–Ω–∏—Ç—å —é–∑–µ—Ä–Ω–µ–π–º</h3>
                <form id="change-username-form">
                    <div class="form-group">
                        <label for="new-username">–ù–æ–≤—ã–π —é–∑–µ—Ä–Ω–µ–π–º</label>
                        <input type="text" id="new-username" value="{{ user.username }}">
                    </div>

                    <div class="form-group">
                        <label for="password-for-username">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="password-for-username">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> –°–º–µ–Ω–∏—Ç—å —é–∑–µ—Ä–Ω–µ–π–º
                    </button>
                </form>
            </div>

            <!-- –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ -->
            <div class="profile-card danger-zone">
                <h3><i class="fas fa-exclamation-triangle"></i> –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h3>
                <p>–≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã.</p>

                <div class="danger-actions">
                    <button class="btn btn-danger btn-block" id="delete-account">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='profile.js') }}"></script>
{% endblock %}

<> register.html

{% extends "base.html" %}

{% block content %}
<div class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="logo">
                    <i class="fas fa-comment-dots"></i>
                    <span>Kildear</span>
                </div>
                <h1>–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç</h1>
                <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ Kildear Messenger</p>
            </div>

            {% if error %}
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                {{ error }}
            </div>
            {% endif %}

            <form method="POST" class="auth-form">
                <div class="form-group">
                    <label for="name">
                        <i class="fas fa-user"></i> –í–∞—à–µ –∏–º—è *
                    </label>
                    <input type="text" id="name" name="name" required
                           placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" value="{{ request.form.name or '' }}">
                </div>

                <div class="form-group">
                    <label for="username">
                        <i class="fas fa-at"></i> –Æ–∑–µ—Ä–Ω–µ–π–º *
                    </label>
                    <div class="input-with-prefix">
                        <span class="prefix">@</span>
                        <input type="text" id="username" name="username" required
                               placeholder="username" value="{{ suggested_username or (request.form.username or '') }}">
                    </div>
                    <div class="form-hint">–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞</div>
                </div>

                <div class="form-group">
                    <label for="description">
                        <i class="fas fa-edit"></i> –û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
                    </label>
                    <textarea id="description" name="description"
                             placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ...">{{ request.form.description or '' }}</textarea>
                </div>

                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i> –ü–∞—Ä–æ–ª—å *
                    </label>
                    <input type="password" id="password" name="password" required>
                    <div class="form-hint">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                </div>

                <div class="form-group">
                    <label for="confirm_password">
                        <i class="fas fa-lock"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å *
                    </label>
                    <input type="password" id="confirm_password" name="confirm_password" required>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-user-plus"></i> –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
                </button>
            </form>

            <div class="auth-footer">
                <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="{{ url_for('login') }}" class="link">–í–æ–π—Ç–∏</a></p>
            </div>

            <div class="security-info">
                <i class="fas fa-shield-alt"></i>
                <span>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã. –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è  –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ.</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

app.py

from flask import Flask, render_template, request, redirect, url_for, session, jsonify, send_from_directory
from flask_socketio import SocketIO, emit, join_room, leave_room
from werkzeug.security import generate_password_hash, check_password_hash
import json
import os
from datetime import datetime
import uuid
import base64
import threading
import time
import logging

app = Flask(__name__)
app.config['SECRET_KEY'] = 'kildear-messenger-secret-2024-secure'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16MB max
app.config['UPLOAD_FOLDER'] = 'static/uploads'

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏
os.makedirs('static/uploads/media', exist_ok=True)
os.makedirs('static/uploads/avatars', exist_ok=True)
os.makedirs('database', exist_ok=True)

socketio = SocketIO(app,
                    cors_allowed_origins="*",
                    async_mode='threading',
                    max_http_buffer_size=50 * 1024 * 1024,
                    ping_timeout=60,
                    ping_interval=25,
                    logger=True,
                    engineio_logger=True)

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
active_calls = {}


# –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
def init_database():
    print("üìÇ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")

    required_files = [
        'database/users.json',
        'database/messages.json',
        'database/online.json',
        'database/blocks.json',
        'database/pinned.json',
        'database/saved_chats.json',
        'database/calls.json'
    ]

    for filepath in required_files:
        if not os.path.exists(filepath):
            print(f"  –°–æ–∑–¥–∞—é: {filepath}")
            with open(filepath, 'w', encoding='utf-8') as f:
                json.dump({}, f, ensure_ascii=False, indent=2)

    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞")


# –í—ã–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
init_database()


# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
def load_json_file(filepath, default_data=None):
    if default_data is None:
        default_data = {}
    try:
        if os.path.exists(filepath) and os.path.getsize(filepath) > 0:
            with open(filepath, 'r', encoding='utf-8') as f:
                return json.load(f)
    except Exception as e:
        logger.error(f"Error loading {filepath}: {e}")
    with open(filepath, 'w', encoding='utf-8') as f:
        json.dump(default_data, f, ensure_ascii=False, indent=2)
    return default_data


def save_json_file(filepath, data):
    try:
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        return True
    except Exception as e:
        logger.error(f"Error saving {filepath}: {e}")
        return False


def load_users():
    return load_json_file('database/users.json', {})


def save_users(users):
    return save_json_file('database/users.json', users)


def load_messages():
    return load_json_file('database/messages.json', {})


def save_messages(messages):
    return save_json_file('database/messages.json', messages)


def load_online():
    return load_json_file('database/online.json', {})


def save_online(online):
    return save_json_file('database/online.json', online)


def load_blocks():
    return load_json_file('database/blocks.json', {})


def save_blocks(blocks):
    return save_json_file('database/blocks.json', blocks)


def load_pinned():
    return load_json_file('database/pinned.json', {})


def save_pinned(pinned):
    return save_json_file('database/pinned.json', pinned)


def load_saved_chats():
    return load_json_file('database/saved_chats.json', {})


def save_saved_chats(chats):
    return save_json_file('database/saved_chats.json', chats)


def load_calls():
    return load_json_file('database/calls.json', {})


def save_calls(calls):
    return save_json_file('database/calls.json', calls)


def save_avatar(username, base64_data):
    try:
        if ',' in base64_data:
            base64_data = base64_data.split(',')[1]

        img_data = base64.b64decode(base64_data)
        filename = f"{username}_{int(datetime.now().timestamp())}.png"
        filepath = os.path.join('static/uploads/avatars', filename)

        with open(filepath, 'wb') as f:
            f.write(img_data)

        return f"/static/uploads/avatars/{filename}"
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∏: {e}")
        return None


def save_media_file(file_data, filename, file_type):
    try:
        if ',' in file_data:
            file_data = file_data.split(',')[1]

        file_bytes = base64.b64decode(file_data)

        file_ext = filename.rsplit('.', 1)[1].lower() if '.' in filename else 'bin'
        unique_filename = f"{uuid.uuid4().hex}.{file_ext}"
        filepath = os.path.join('static/uploads/media', unique_filename)

        with open(filepath, 'wb') as f:
            f.write(file_bytes)

        return f"media/{unique_filename}"
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞: {e}")
        return None


def generate_color_from_username(username):
    colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8']
    hash_value = sum(ord(char) for char in username)
    return colors[hash_value % len(colors)]


def is_username_taken(username, exclude_user=None):
    users = load_users()
    if exclude_user and username == exclude_user:
        return False
    return username in users


def generate_unique_username(base_username):
    users = load_users()
    if base_username not in users:
        return base_username

    counter = 1
    while True:
        new_username = f"{base_username}{counter}"
        if new_username not in users:
            return new_username
        counter += 1


def is_user_blocked(blocker, blocked_user):
    blocks = load_blocks()
    if blocker in blocks and blocked_user in blocks[blocker]:
        return True
    return False


def block_user(blocker, user_to_block):
    blocks = load_blocks()
    if blocker not in blocks:
        blocks[blocker] = []
    if user_to_block not in blocks[blocker]:
        blocks[blocker].append(user_to_block)
        save_blocks(blocks)
        return True
    return False


def unblock_user(blocker, user_to_unblock):
    blocks = load_blocks()
    if blocker in blocks and user_to_unblock in blocks[blocker]:
        blocks[blocker].remove(user_to_unblock)
        save_blocks(blocks)
        return True
    return False


def get_blocked_users(username):
    blocks = load_blocks()
    return blocks.get(username, [])


def pin_message(username, message_id):
    pinned = load_pinned()
    if username not in pinned:
        pinned[username] = []
    if message_id not in pinned[username]:
        pinned[username].append(message_id)
        save_pinned(pinned)
        return True
    return False


def unpin_message(username, message_id):
    pinned = load_pinned()
    if username in pinned and message_id in pinned[username]:
        pinned[username].remove(message_id)
        save_pinned(pinned)
        return True
    return False


def get_pinned_messages(username):
    pinned = load_pinned()
    return pinned.get(username, [])


# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
def save_call_record(call_data):
    calls = load_calls()
    call_id = call_data['call_id']
    calls[call_id] = call_data
    save_calls(calls)


def get_call_history(username):
    calls = load_calls()
    user_calls = []
    for call_id, call_data in calls.items():
        if call_data['caller'] == username or call_data['callee'] == username:
            user_calls.append(call_data)
    return user_calls


# –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
def is_admin(username):
    admins = ['admin', 'administrator', 'root', 'moderator']
    return username.lower() in admins


def admin_get_user_messages(username):
    messages = load_messages()
    user_messages = []

    for dialog_key, dialog_messages in messages.items():
        for msg in dialog_messages:
            if msg['sender'] == username or msg['recipient'] == username:
                user_messages.append({
                    'dialog': dialog_key,
                    'message': msg
                })

    return user_messages


def admin_get_all_users():
    users = load_users()
    online_users = load_online()

    result = []
    for username, user_data in users.items():
        is_online = online_users.get(username, {}).get('online', False)
        last_seen = online_users.get(username, {}).get('last_seen', '')

        result.append({
            'username': username,
            'name': user_data['name'],
            'email': user_data.get('email', ''),
            'created_at': user_data.get('created_at', ''),
            'last_seen': last_seen,
            'online': is_online,
            'blocked': user_data.get('blocked', False),
            'message_count': admin_get_user_message_count(username)
        })

    return result


def admin_get_user_message_count(username):
    messages = load_messages()
    count = 0

    for dialog_key, dialog_messages in messages.items():
        for msg in dialog_messages:
            if msg['sender'] == username or msg['recipient'] == username:
                count += 1

    return count


def admin_block_user(username):
    users = load_users()
    if username in users:
        users[username]['blocked'] = True
        save_users(users)
        return True
    return False


def admin_unblock_user(username):
    users = load_users()
    if username in users:
        users[username]['blocked'] = False
        save_users(users)
        return True
    return False


def admin_change_username(old_username, new_username):
    users = load_users()

    if old_username not in users:
        return False, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"

    if is_username_taken(new_username, exclude_user=old_username):
        return False, "–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç"

    # –û–±–Ω–æ–≤–ª—è–µ–º username –≤–æ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
    messages = load_messages()
    for dialog_key in list(messages.keys()):
        if old_username in dialog_key:
            usernames = dialog_key.split('_')
            if usernames[0] == old_username:
                new_dialog_key = f"{new_username}_{usernames[1]}"
            else:
                new_dialog_key = f"{usernames[0]}_{new_username}"

            for message in messages[dialog_key]:
                if message['sender'] == old_username:
                    message['sender'] = new_username
                if message['recipient'] == old_username:
                    message['recipient'] = new_username

            messages[new_dialog_key] = messages.pop(dialog_key)

    save_messages(messages)

    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    users[new_username] = users.pop(old_username)
    users[new_username]['username'] = new_username
    save_users(users)

    # –û–±–Ω–æ–≤–ª—è–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
    online_users = load_online()
    if old_username in online_users:
        online_users[new_username] = online_users.pop(old_username)

    # –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    blocks = load_blocks()
    for blocker, blocked_list in list(blocks.items()):
        if old_username in blocked_list:
            blocked_list[blocked_list.index(old_username)] = new_username

    return True, "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–µ–Ω–æ"


# –ù–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–∏—Å–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Ç–∞
@app.route('/api/get_all_users')
def api_get_all_users():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    users = load_users()
    online_users = load_online()

    result = []
    current_username = session['username']
    blocked_users = get_blocked_users(current_username)

    for username, user_data in users.items():
        if username == current_username:
            continue

        if username in blocked_users:
            continue

        is_online = online_users.get(username, {}).get('online', False)
        last_seen = online_users.get(username, {}).get('last_seen', '')

        result.append({
            'username': username,
            'name': user_data['name'],
            'description': user_data.get('description', ''),
            'avatar': user_data.get('avatar'),
            'avatar_color': user_data.get('avatar_color', '#4ECDC4'),
            'is_online': is_online,
            'last_seen': last_seen,
            'created_at': user_data.get('created_at', '')
        })

    return jsonify(result)


@app.route('/api/save_current_chat', methods=['POST'])
def api_save_current_chat():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    data = request.json
    chat_with = data.get('chat_with')

    if not chat_with:
        return jsonify({'error': 'No user specified'}), 400

    saved_chats = load_saved_chats()
    username = session['username']

    if username not in saved_chats:
        saved_chats[username] = {}

    saved_chats[username]['current_chat'] = chat_with
    saved_chats[username]['last_opened'] = datetime.now().isoformat()

    save_saved_chats(saved_chats)

    return jsonify({'success': True})


@app.route('/api/save_chat', methods=['POST'])
def save_chat():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    data = request.json
    chat_with = data.get('chat_with')

    if not chat_with:
        return jsonify({'error': 'No user specified'}), 400

    saved_chats = load_saved_chats()
    username = session['username']

    if username not in saved_chats:
        saved_chats[username] = {}

    saved_chats[username]['current_chat'] = chat_with
    saved_chats[username]['last_opened'] = datetime.now().isoformat()

    save_saved_chats(saved_chats)
    return jsonify({'success': True})

# –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
@app.route('/api/get_call_history')
def api_get_call_history():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    calls = get_call_history(session['username'])
    return jsonify(calls)


# –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
@app.route('/')
def index():
    if 'username' in session:
        return redirect(url_for('chat'))
    return redirect(url_for('login'))


@app.route('/register', methods=['GET', 'POST'])
def register():
    if 'username' in session:
        return redirect(url_for('chat'))

    if request.method == 'POST':
        username = request.form.get('username', '').strip().lower()
        name = request.form.get('name', '').strip()
        description = request.form.get('description', '').strip()
        password = request.form.get('password', '').strip()
        confirm_password = request.form.get('confirm_password', '').strip()

        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        if not username or not name or not password:
            return render_template('register.html', error='–í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã')

        if len(username) < 3:
            return render_template('register.html', error='–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤')

        if len(password) < 6:
            return render_template('register.html', error='–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤')

        if password != confirm_password:
            return render_template('register.html', error='–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç')

        users = load_users()

        if is_username_taken(username):
            suggested_username = generate_unique_username(username)
            return render_template('register.html',
                                   error=f'–Æ–∑–µ—Ä–Ω–µ–π–º "{username}" –∑–∞–Ω—è—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ "{suggested_username}"',
                                   suggested_username=suggested_username)

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        users[username] = {
            'name': name,
            'description': description,
            'username': username,
            'password_hash': generate_password_hash(password),
            'avatar_color': generate_color_from_username(username),
            'avatar': None,
            'theme': 'dark',
            'created_at': datetime.now().isoformat(),
            'last_seen': datetime.now().isoformat(),
            'blocked': False
        }
        save_users(users)

        session['username'] = username

        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ–Ω–ª–∞–π–Ω
        online_users = load_online()
        online_users[username] = {
            'online': True,
            'last_seen': datetime.now().isoformat()
        }
        save_online(online_users)

        return redirect(url_for('chat'))

    return render_template('register.html')


@app.route('/login', methods=['GET', 'POST'])
def login():
    if 'username' in session:
        return redirect(url_for('chat'))

    if request.method == 'POST':
        username = request.form.get('username', '').strip().lower()
        password = request.form.get('password', '').strip()

        users = load_users()
        if username in users:
            user = users[username]

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
            if user.get('blocked', False):
                return render_template('login.html', error='–ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω')

            if check_password_hash(user['password_hash'], password):
                session['username'] = username

                # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω
                online_users = load_online()
                online_users[username] = {
                    'online': True,
                    'last_seen': datetime.now().isoformat()
                }
                save_online(online_users)

                return redirect(url_for('chat'))
            else:
                return render_template('login.html', error='–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å')
        else:
            return render_template('login.html', error='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω')

    return render_template('login.html')


@app.route('/logout')
def logout():
    if 'username' in session:
        username = session['username']
        online_users = load_online()
        if username in online_users:
            online_users[username] = {
                'online': False,
                'last_seen': datetime.now().isoformat()
            }
            save_online(online_users)
    session.clear()
    return redirect(url_for('login'))


@app.route('/chat')
def chat():
    if 'username' not in session:
        return redirect(url_for('login'))

    users = load_users()
    current_user = users.get(session['username'])

    if not current_user:
        session.clear()
        return redirect(url_for('login'))

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    if current_user.get('blocked', False):
        session.clear()
        return render_template('blocked.html')

    return render_template('chat.html', current_user=current_user, is_admin=is_admin(session['username']))


@app.route('/profile')
@app.route('/profile/<username>')
def profile(username=None):
    if 'username' not in session:
        return redirect(url_for('login'))

    current_username = session['username']
    users = load_users()
    current_user = users.get(current_username)

    if not current_user:
        session.clear()
        return redirect(url_for('login'))

    # –ï—Å–ª–∏ username –Ω–µ —É–∫–∞–∑–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if not username:
        return render_template('profile.html',
                               user=current_user,
                               is_admin=is_admin(current_username))

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    other_user = users.get(username)
    if not other_user:
        return redirect(url_for('profile'))

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    blocked_users = get_blocked_users(current_username)
    is_blocked_by_me = username in blocked_users

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ –º–µ–Ω—è —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    is_blocking_me = is_user_blocked(username, current_username)

    return render_template('profile.html',
                           user=other_user,
                           is_other_profile=True,
                           is_blocked=is_blocked_by_me,
                           is_blocking_me=is_blocking_me,
                           is_admin=is_admin(current_username),
                           current_user=current_user)


@app.route('/api/profile/update', methods=['POST'])
def update_profile():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    users = load_users()
    current_user = users.get(session['username'])

    if not current_user:
        return jsonify({'success': False, 'message': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω'}), 404

    data = request.json

    # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    if 'name' in data:
        current_user['name'] = data['name'].strip()

    if 'description' in data:
        current_user['description'] = data['description'].strip()

    if 'theme' in data and data['theme'] in ['dark', 'light']:
        current_user['theme'] = data['theme']

    if 'avatar' in data and data['avatar']:
        avatar_url = save_avatar(session['username'], data['avatar'])
        if avatar_url:
            current_user['avatar'] = avatar_url

    users[session['username']] = current_user
    save_users(users)

    return jsonify({'success': True, 'message': '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω'})


@app.route('/api/profile/change_password', methods=['POST'])
def change_password():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    users = load_users()
    current_user = users.get(session['username'])

    if not current_user:
        return jsonify({'success': False, 'message': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω'}), 404

    data = request.json
    current_password = data.get('current_password', '')
    new_password = data.get('new_password', '')
    confirm_password = data.get('confirm_password', '')

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å
    if not check_password_hash(current_user['password_hash'], current_password):
        return jsonify({'success': False, 'message': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å'})

    # –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
    if len(new_password) < 6:
        return jsonify({'success': False, 'message': '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤'})

    if new_password != confirm_password:
        return jsonify({'success': False, 'message': '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'})

    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å
    current_user['password_hash'] = generate_password_hash(new_password)
    users[session['username']] = current_user
    save_users(users)

    return jsonify({'success': True, 'message': '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω'})


@app.route('/api/profile/change_username', methods=['POST'])
def change_username():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    data = request.json
    new_username = data.get('new_username', '').strip().lower()
    password = data.get('password', '')

    if not new_username or not password:
        return jsonify({'success': False, 'message': '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'})

    if len(new_username) < 3:
        return jsonify({'success': False, 'message': '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤'})

    users = load_users()
    current_user = users.get(session['username'])

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    if not check_password_hash(current_user['password_hash'], password):
        return jsonify({'success': False, 'message': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'})

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–Ω—è—Ç –ª–∏ —é–∑–µ—Ä–Ω–µ–π–º
    if is_username_taken(new_username, exclude_user=session['username']):
        return jsonify({'success': False, 'message': '–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç'})

    success, message = admin_change_username(session['username'], new_username)
    if success:
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é
        session['username'] = new_username
        return jsonify({'success': True, 'message': message, 'new_username': new_username})
    else:
        return jsonify({'success': False, 'message': message})


@app.route('/api/user/<username>')
def get_user(username):
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    users = load_users()
    user = users.get(username)

    if not user:
        return jsonify({'error': 'User not found'}), 404

    # –°–∫—Ä—ã–≤–∞–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    user_data = {
        'name': user['name'],
        'username': user['username'],
        'description': user.get('description', ''),
        'avatar': user.get('avatar'),
        'avatar_color': user.get('avatar_color', '#4ECDC4'),
        'created_at': user.get('created_at', '')
    }

    return jsonify(user_data)


@app.route('/search_users')
def search_users():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    query = request.args.get('q', '').lower().strip()
    if not query:
        return jsonify([])

    users = load_users()
    results = []

    current_user = session['username']
    blocked_users = get_blocked_users(current_user)

    for username, user_data in users.items():
        if username == session['username']:
            continue

        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        if username in blocked_users:
            continue

        if (query in username.lower() or
                query in user_data['name'].lower() or
                (user_data.get('description') and query in user_data['description'].lower())):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
            online_users = load_online()
            is_online = online_users.get(username, {}).get('online', False)

            results.append({
                'username': username,
                'name': user_data['name'],
                'description': user_data.get('description', ''),
                'avatar': user_data.get('avatar'),
                'avatar_color': user_data.get('avatar_color', '#4ECDC4'),
                'is_online': is_online
            })

    return jsonify(results)


@app.route('/get_messages/<recipient>')
def get_messages(recipient):
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    sender = session['username']

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    if is_user_blocked(sender, recipient) or is_user_blocked(recipient, sender):
        return jsonify({'error': 'User blocked', 'messages': []})

    dialog_key = '_'.join(sorted([sender, recipient]))

    messages = load_messages()
    dialog_messages = messages.get(dialog_key, [])

    # –§–∏–ª—å—Ç—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö)
    filtered_messages = []
    for msg in dialog_messages:
        if not msg.get('deleted') or (msg.get('deleted_by') == sender and not msg.get('permanent')):
            filtered_messages.append(msg)

    return jsonify(filtered_messages)


@app.route('/get_online_status')
def get_online_status():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    online_users = load_online()
    return jsonify(online_users)


@app.route('/api/get_chats')
def get_chats():
    if 'username' not in session:
        return jsonify([]), 401

    username = session['username']
    users = load_users()
    messages = load_messages()

    chats = []
    for dialog_key in messages.keys():
        if username in dialog_key:
            usernames = dialog_key.split('_')
            other_user = usernames[0] if usernames[1] == username else usernames[1]

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            if is_user_blocked(username, other_user) or is_user_blocked(other_user, username):
                continue

            if other_user in users:
                user_data = users[other_user]

                # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ —É–¥–∞–ª–µ–Ω–Ω–æ–µ)
                dialog_messages = messages[dialog_key]
                last_message = None
                for msg in reversed(dialog_messages):
                    if not msg.get('deleted') or (msg.get('deleted_by') == username and not msg.get('permanent')):
                        last_message = {
                            'message': msg.get('message', ''),
                            'type': msg.get('type', 'text'),
                            'timestamp': msg.get('timestamp')
                        }
                        break

                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
                online_users = load_online()
                is_online = online_users.get(other_user, {}).get('online', False)

                chats.append({
                    'username': other_user,
                    'name': user_data['name'],
                    'description': user_data.get('description', ''),
                    'avatar': user_data.get('avatar'),
                    'avatar_color': user_data.get('avatar_color', '#4ECDC4'),
                    'last_message': last_message,
                    'is_online': is_online
                })

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    chats.sort(key=lambda x: x['last_message']['timestamp'] if x['last_message'] else '', reverse=True)

    return jsonify(chats)


@app.route('/api/block_user', methods=['POST'])
def api_block_user():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    data = request.json
    user_to_block = data.get('username', '')

    if not user_to_block:
        return jsonify({'success': False, 'message': '–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})

    if user_to_block == session['username']:
        return jsonify({'success': False, 'message': '–ù–µ–ª—å–∑—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è'})

    if block_user(session['username'], user_to_block):
        return jsonify({'success': True, 'message': f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{user_to_block} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'})
    else:
        return jsonify({'success': False, 'message': '–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏'})


@app.route('/api/unblock_user', methods=['POST'])
def api_unblock_user():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    data = request.json
    user_to_unblock = data.get('username', '')

    if not user_to_unblock:
        return jsonify({'success': False, 'message': '–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'})

    if unblock_user(session['username'], user_to_unblock):
        return jsonify({'success': True, 'message': f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{user_to_unblock} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'})
    else:
        return jsonify({'success': False, 'message': '–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏'})


@app.route('/api/get_blocked_users')
def api_get_blocked_users():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    blocked_users = get_blocked_users(session['username'])
    users = load_users()

    result = []
    for username in blocked_users:
        if username in users:
            user_data = users[username]
            result.append({
                'username': username,
                'name': user_data['name'],
                'avatar': user_data.get('avatar'),
                'avatar_color': user_data.get('avatar_color', '#4ECDC4')
            })

    return jsonify(result)


@app.route('/api/pin_message', methods=['POST'])
def api_pin_message():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    data = request.json
    message_id = data.get('message_id', '')

    if not message_id:
        return jsonify({'success': False, 'message': '–£–∫–∞–∂–∏—Ç–µ ID —Å–æ–æ–±—â–µ–Ω–∏—è'})

    if pin_message(session['username'], message_id):
        return jsonify({'success': True, 'message': '–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ'})
    else:
        return jsonify({'success': False, 'message': '–û—à–∏–±–∫–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è'})


@app.route('/api/unpin_message', methods=['POST'])
def api_unpin_message():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    data = request.json
    message_id = data.get('message_id', '')

    if not message_id:
        return jsonify({'success': False, 'message': '–£–∫–∞–∂–∏—Ç–µ ID —Å–æ–æ–±—â–µ–Ω–∏—è'})

    if unpin_message(session['username'], message_id):
        return jsonify({'success': True, 'message': '–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ'})
    else:
        return jsonify({'success': False, 'message': '–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è'})


@app.route('/api/get_pinned_messages')
def api_get_pinned_messages():
    if 'username' not in session:
        return jsonify({'error': 'Not authorized'}), 401

    pinned_ids = get_pinned_messages(session['username'])
    messages = load_messages()

    pinned_messages = []
    for dialog_key, dialog_messages in messages.items():
        for msg in dialog_messages:
            if msg['id'] in pinned_ids and not msg.get('deleted'):
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–∏–∞–ª–æ–≥–µ
                usernames = dialog_key.split('_')
                other_user = usernames[0] if usernames[1] == session['username'] else usernames[1]

                pinned_messages.append({
                    'message': msg,
                    'dialog_with': other_user
                })

    return jsonify(pinned_messages)


@app.route('/api/edit_message', methods=['POST'])
def api_edit_message():
    if 'username' not in session:
        return jsonify({'success': False, 'message': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'}), 401

    data = request.json
    message_id = data.get('message_id', '')
    new_text = data.get('new_text', '')

    if not message_id or not new_text:
        return jsonify({'success': False, 'message': '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'})

    messages = load_messages()

    for dialog_key, dialog_messages in messages.items():
        for msg in dialog_messages:
            if msg['id'] == message_id and msg['sender'] == session['username'] and not msg.get('deleted'):
                msg['message'] = new_text
                msg['edited'] = True
                msg['edited_at'] = datetime.now().isoformat()

                save_messages(messages)

                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
                socketio.emit('message_edited', {
                    'message_id': message_id,
                    'new_text': new_text,
                    'edited_at': msg['edited_at']
                }, room=dialog_key)

                return jsonify({'success': True, 'message': '–°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ'})

    return jsonify({'success': False, 'message': '–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤'})


@app.route('/static/uploads/<path:filename>')
def serve_uploaded_file(filename):
    return send_from_directory('static/uploads', filename)


# WebSocket —Å–æ–±—ã—Ç–∏—è –¥–ª—è —á–∞—Ç–∞
@socketio.on('connect')
def handle_connect():
    if 'username' in session:
        username = session['username']
        join_room(username)

        online_users = load_online()
        online_users[username] = {
            'online': True,
            'last_seen': datetime.now().isoformat()
        }
        save_online(online_users)

        emit('user_status', {
            'username': username,
            'online': True,
            'last_seen': datetime.now().isoformat()
        }, broadcast=True)

        logger.info(f"‚úì –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è: {username}")


@socketio.on('disconnect')
def handle_disconnect():
    if 'username' in session:
        username = session['username']
        leave_room(username)

        online_users = load_online()
        if username in online_users:
            online_users[username] = {
                'online': False,
                'last_seen': datetime.now().isoformat()
            }
            save_online(online_users)

        emit('user_status', {
            'username': username,
            'online': False,
            'last_seen': datetime.now().isoformat()
        }, broadcast=True)

        logger.info(f"‚úó –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è: {username}")


@socketio.on('typing')
def handle_typing(data):
    if 'username' in session:
        sender = session['username']
        recipient = data.get('recipient')

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        if not is_user_blocked(sender, recipient) and not is_user_blocked(recipient, sender):
            emit('user_typing', {
                'username': sender,
                'recipient': recipient,
                'is_typing': data.get('is_typing', False)
            }, room=recipient)


@socketio.on('send_message')
def handle_send_message(data):
    sender = session.get('username')
    if not sender:
        return {'error': 'Not authorized'}

    recipient = data.get('recipient')
    message = data.get('message', '').strip()
    message_type = data.get('type', 'text')
    file_data = data.get('file_data')
    file_name = data.get('file_name')
    file_size = data.get('file_size')
    reply_to = data.get('reply_to')
    forward_from = data.get('forward_from')

    if not recipient or (not message and not file_data and message_type in ['text', 'sticker']):
        return {'error': 'No message content'}

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    if is_user_blocked(sender, recipient) or is_user_blocked(recipient, sender):
        return {'error': 'User blocked'}

    dialog_key = '_'.join(sorted([sender, recipient]))

    messages = load_messages()
    if dialog_key not in messages:
        messages[dialog_key] = []

    message_id = str(uuid.uuid4())
    timestamp = datetime.now().isoformat()

    message_obj = {
        'id': message_id,
        'sender': sender,
        'recipient': recipient,
        'message': message,
        'type': message_type,
        'timestamp': timestamp,
        'read': False,
        'edited': False,
        'reply_to': reply_to,
        'forward_from': forward_from
    }

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
    if file_data and file_name and message_type in ['image', 'video']:
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
            if len(file_data) > 50 * 1024 * 1024:  # 50MB max
                return {'error': 'File too large'}

            file_path = save_media_file(file_data, file_name, message_type)
            if file_path:
                message_obj['file_path'] = file_path
                message_obj['file_name'] = file_name
                message_obj['file_size'] = file_size
            else:
                return {'error': 'Failed to save file'}
        except Exception as e:
            print(f"Error saving media file: {e}")
            return {'error': 'Media upload failed'}

    messages[dialog_key].append(message_obj)

    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
    if len(messages[dialog_key]) > 1000:
        messages[dialog_key] = messages[dialog_key][-1000:]

    save_messages(messages)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—é
    try:
        emit('new_message', message_obj, room=recipient)
    except Exception as e:
        print(f"Error emitting to recipient: {e}")

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é
    try:
        emit('message_sent', message_obj, room=sender)
    except Exception as e:
        print(f"Error emitting to sender: {e}")

    logger.info(f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {sender} ‚Üí {recipient}")
    return {'success': True}


@socketio.on('delete_message')
def handle_delete_message(data):
    if 'username' not in session:
        return

    message_id = data.get('message_id')
    delete_for_everyone = data.get('delete_for_everyone', False)
    username = session['username']

    messages = load_messages()

    for dialog_key, dialog_messages in messages.items():
        for msg in dialog_messages:
            if msg['id'] == message_id:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
                if msg['sender'] == username or delete_for_everyone or is_admin(username):
                    # –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ
                    msg['deleted'] = True
                    msg['deleted_by'] = username
                    msg['deleted_at'] = datetime.now().isoformat()
                    msg['permanent'] = delete_for_everyone or is_admin(username)

                    save_messages(messages)

                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    emit('message_deleted', {
                        'message_id': message_id,
                        'deleted_by': username,
                        'permanent': msg['permanent']
                    }, room=dialog_key)

                    # –¢–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
                    for user in dialog_key.split('_'):
                        emit('message_deleted', {
                            'message_id': message_id,
                            'deleted_by': username
                        }, room=user)

                    logger.info(f"üóëÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ {message_id} —É–¥–∞–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {username}")
                    return
                else:
                    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å —á—É–∂–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ñ–ª–∞–≥–∞ delete_for_everyone
                    emit('error', {'message': '–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ'}, room=username)
                    return


# WebSocket —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
@socketio.on('start_call')
def handle_start_call(data):
    if 'username' not in session:
        return

    caller = session['username']
    callee = data.get('to')
    call_id = data.get('call_id')
    call_type = data.get('call_type')

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    if is_user_blocked(caller, callee) or is_user_blocked(callee, caller):
        emit('call_error', {'message': 'User blocked'}, room=caller)
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
    online_users = load_online()
    if not online_users.get(callee, {}).get('online', False):
        emit('call_error', {'message': 'User is offline'}, room=caller)
        return

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–≤–æ–Ω–∫–µ
    active_calls[call_id] = {
        'caller': caller,
        'callee': callee,
        'type': call_type,
        'started_at': datetime.now().isoformat(),
        'status': 'ringing'
    }

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–≤–æ–Ω–æ–∫
    emit('incoming_call', {
        'caller': caller,
        'call_id': call_id,
        'type': call_type,
        'timestamp': datetime.now().isoformat()
    }, room=callee)

    # –¢–∞–π–º–µ—Ä –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ (30 —Å–µ–∫—É–Ω–¥)
    def call_timeout():
        if call_id in active_calls and active_calls[call_id]['status'] == 'ringing':
            emit('call_timeout', {'call_id': call_id}, room=caller)
            del active_calls[call_id]

    socketio.start_background_task(
        lambda: (time.sleep(30), call_timeout())
    )


@socketio.on('accept_call')
def handle_accept_call(data):
    if 'username' not in session:
        return

    callee = session['username']
    call_id = data.get('call_id')

    if call_id not in active_calls:
        emit('call_error', {'message': 'Call not found'}, room=callee)
        return

    call_info = active_calls[call_id]

    if call_info['callee'] != callee:
        emit('call_error', {'message': 'Not authorized'}, room=callee)
        return

    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–≤–æ–Ω–∫–∞
    active_calls[call_id]['status'] = 'active'
    active_calls[call_id]['accepted_at'] = datetime.now().isoformat()

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–≤–æ–Ω—è—â–µ–º—É
    emit('call_accepted', {
        'call_id': call_id,
        'callee': callee,
        'timestamp': datetime.now().isoformat()
    }, room=call_info['caller'])

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –∑–≤–æ–Ω—è—â–µ–º—É –æ –Ω–∞—á–∞–ª–µ –∑–≤–æ–Ω–∫–∞
    emit('call_started', {
        'call_id': call_id,
        'timestamp': datetime.now().isoformat()
    }, room=call_info['caller'])


@socketio.on('reject_call')
def handle_reject_call(data):
    if 'username' not in session:
        return

    callee = session['username']
    call_id = data.get('call_id')

    if call_id not in active_calls:
        return

    call_info = active_calls[call_id]

    if call_info['callee'] != callee:
        return

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–≤–æ–Ω—è—â–µ–º—É
    emit('call_rejected', {
        'call_id': call_id,
        'reason': data.get('reason', 'User rejected the call')
    }, room=call_info['caller'])

    # –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–≤–æ–Ω–∫–µ
    if call_id in active_calls:
        del active_calls[call_id]


@socketio.on('end_call')
def handle_end_call(data):
    if 'username' not in session:
        return

    user = session['username']
    call_id = data.get('call_id')

    if call_id not in active_calls:
        return

    call_info = active_calls[call_id]

    if user not in [call_info['caller'], call_info['callee']]:
        return

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—Ç–æ –∑–∞–≤–µ—Ä—à–∏–ª –∑–≤–æ–Ω–æ–∫
    ended_by = user

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    if user == call_info['caller']:
        recipient = call_info['callee']
    else:
        recipient = call_info['caller']

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å—å –æ –∑–≤–æ–Ω–∫–µ
    call_record = {
        'call_id': call_id,
        'caller': call_info['caller'],
        'callee': call_info['callee'],
        'type': call_info['type'],
        'started_at': call_info.get('started_at'),
        'ended_at': datetime.now().isoformat(),
        'duration': data.get('duration', 0),
        'ended_by': ended_by
    }
    save_call_record(call_record)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    emit('call_ended', {
        'call_id': call_id,
        'ended_by': ended_by,
        'duration': data.get('duration', 0),
        'timestamp': datetime.now().isoformat()
    }, room=recipient)

    # –£–¥–∞–ª—è–µ–º –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
    if call_id in active_calls:
        del active_calls[call_id]


@socketio.on('webrtc_signal')
def handle_webrtc_signal(data):
    if 'username' not in session:
        return

    sender = session['username']
    recipient = data.get('to')
    signal = data.get('signal')
    call_id = data.get('call_id')

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–≤–æ–Ω–æ–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if call_id not in active_calls:
        return

    call_info = active_calls[call_id]

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∑–≤–æ–Ω–∫–∞
    if sender not in [call_info['caller'], call_info['callee']]:
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∑–≤–æ–Ω–∫–∞
    if recipient not in [call_info['caller'], call_info['callee']]:
        return

    # –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º —Å–∏–≥–Ω–∞–ª –ø–æ–ª—É—á–∞—Ç–µ–ª—é
    emit('webrtc_signal', {
        'from': sender,
        'signal': signal,
        'call_id': call_id
    }, room=recipient)


@socketio.on('call_ice_candidate')
def handle_call_ice_candidate(data):
    if 'username' not in session:
        return

    sender = session['username']
    recipient = data.get('to')
    candidate = data.get('candidate')
    call_id = data.get('call_id')

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–≤–æ–Ω–æ–∫ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if call_id not in active_calls:
        return

    call_info = active_calls[call_id]

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∑–≤–æ–Ω–∫–∞
    if sender not in [call_info['caller'], call_info['callee']]:
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º –∑–≤–æ–Ω–∫–∞
    if recipient not in [call_info['caller'], call_info['callee']]:
        return

    # –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
    emit('call_ice_candidate', {
        'from': sender,
        'candidate': candidate,
        'call_id': call_id
    }, room=recipient)


# –ê–¥–º–∏–Ω-–∫–æ–Ω—Å–æ–ª—å
def admin_console():
    while True:
        try:
            command = input("\nüëë –ê–¥–º–∏–Ω> ").strip().lower()

            if command == 'exit' or command == 'quit':
                break
            elif command == 'users':
                users = admin_get_all_users()
                print(f"\n–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(users)}")
                for user in users:
                    status = '‚úÖ –æ–Ω–ª–∞–π–Ω' if user['online'] else '‚è∏Ô∏è –æ—Ñ–ª–∞–π–Ω'
                    blocked = 'üö´ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' if user['blocked'] else '‚úÖ –∞–∫—Ç–∏–≤–µ–Ω'
                    print(f"  @{user['username']} - {user['name']} - {status} - {blocked}")

            elif command.startswith('messages '):
                username = command.split(' ', 1)[1]
                messages = admin_get_user_messages(username)
                print(f"\n–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @{username}: {len(messages)}")
                for msg in messages[:10]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 10
                    print(
                        f"  [{msg['message']['timestamp']}] {msg['message']['sender']} ‚Üí {msg['message']['recipient']}: {msg['message']['message'][:50]}")

            elif command.startswith('block '):
                username = command.split(' ', 1)[1]
                if admin_block_user(username):
                    print(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")
                else:
                    print(f"‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @{username}")

            elif command.startswith('unblock '):
                username = command.split(' ', 1)[1]
                if admin_unblock_user(username):
                    print(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{username} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")
                else:
                    print(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è @{username}")

            elif command.startswith('rename '):
                parts = command.split(' ')
                if len(parts) == 3:
                    old_username, new_username = parts[1], parts[2]
                    success, message = admin_change_username(old_username, new_username)
                    if success:
                        print(f"‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑–º–µ–Ω–µ–Ω–æ: @{old_username} ‚Üí @{new_username}")
                    else:
                        print(f"‚ùå {message}")
                else:
                    print("‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: rename <—Å—Ç–∞—Ä—ã–π_—é–∑–µ—Ä–Ω–µ–π–º> <–Ω–æ–≤—ã–π_—é–∑–µ—Ä–Ω–µ–π–º>")

            elif command == 'calls':
                calls = load_calls()
                print(f"\n–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤: {len(calls)}")
                for call_id, call_data in list(calls.items())[:10]:
                    print(
                        f"  [{call_data.get('started_at', '')}] {call_data['caller']} ‚Üí {call_data['callee']} ({call_data['type']})")

            elif command == 'help' or command == '?':
                print("\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:")
                print("  users - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
                print("  messages <user> - –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
                print("  block <user> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
                print("  unblock <user> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
                print("  rename <old> <new> - –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
                print("  calls - –ø–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–≤–æ–Ω–∫–æ–≤")
                print("  exit - –≤—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω-–∫–æ–Ω—Å–æ–ª–∏")
            else:
                print("‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –í–≤–µ–¥–∏—Ç–µ 'help' –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.")

        except KeyboardInterrupt:
            break
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")


# –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–∫–æ–Ω—Å–æ–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
def start_admin_console():
    time.sleep(2)
    admin_console()


if __name__ == '__main__':
    port = int(os.environ.get('PORT', 5000))

    print("=" * 60)
    print("üöÄ KILDEAR MESSENGER –ó–ê–ü–£–©–ï–ù")
    print("=" * 60)
    print(f"üì° –ü–æ—Ä—Ç: {port}")
    print(f"   ‚Ä¢ –õ–æ–∫–∞–ª—å–Ω–æ: http://localhost:{port}")
    print("=" * 60)
    print("üîí –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:")
    print("   ‚Ä¢ –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π")
    print("   ‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    print("   ‚Ä¢ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å")
    print("=" * 60)
    print("üìã –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:")
    print("   ‚Ä¢ –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("   ‚Ä¢ –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è")
    print("   ‚Ä¢ –ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("   ‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("   ‚Ä¢ –°—Ç–∏–∫–µ—Ä—ã")
    print("   ‚Ä¢ –ê—É–¥–∏–æ/–í–∏–¥–µ–æ –∑–≤–æ–Ω–∫–∏")
    print("=" * 60)
    print("‚öôÔ∏è  –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã:")
    print("   ‚Ä¢ users - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    print("   ‚Ä¢ messages <user> - –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("   ‚Ä¢ block <user> - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("   ‚Ä¢ unblock <user> - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("   ‚Ä¢ rename <old> <new> - –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("   ‚Ä¢ calls - –ø–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–≤–æ–Ω–∫–æ–≤")
    print("=" * 60)
    print("‚ö†Ô∏è  –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
    print("=" * 60)

    # –ó–∞–ø—É—Å–∫–∞–µ–º –∞–¥–º–∏–Ω-–∫–æ–Ω—Å–æ–ª—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    admin_thread = threading.Thread(target=start_admin_console, daemon=True)
    admin_thread.start()

    socketio.run(app, debug=False, host='0.0.0.0', port=port, allow_unsafe_werkzeug=True)


requirements.txt

–¥–æ–±–∞–≤—å —Å—Ç–∏–∫–µ—Ä—ã –∞ —Ç–∞–∫–∂–µ –≤–µ—Ä–Ω–∏ –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –ø–µ—Ä–µ–µ—Å–ª–∞–∞—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å —É—É–¥–∞–ª–∏—Ç—å –∏ –∑–∞–∫—Ä–µ–ø–∏—Ç—å,—Ç–∞–∫–∂–µ –∏—Å–ø—Ä–∞–≤—å –ø—Ä–æ–±–ª–µ–º—É —Å–æ –∑–≤–æ–Ω–∫–∞–º–∏ –ø–∏—à–µ—Ç –Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∫—É

–Ω–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã–µ –∫–æ–¥—ã